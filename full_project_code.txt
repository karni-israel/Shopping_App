================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\context\AuthContext.tsx
================================
import { createContext, useContext, useState, useEffect } from 'react';
import type { ReactNode } from 'react';
import api from '../services/api';

interface User {
  id: number;
  username: string;
  email: string;
}

interface AuthContextType {
  user: User | null;
  loading: boolean;
  login: (credentials: any) => Promise<void>;
  register: (data: any) => Promise<void>;
  logout: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider = ({ children }: { children: ReactNode }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  // ׳‘׳“׳™׳§׳” ׳”׳׳ ׳”׳׳©׳×׳׳© ׳׳—׳•׳‘׳¨ ׳‘׳¢׳× ׳˜׳¢׳™׳ ׳× ׳”׳׳×׳¨
  useEffect(() => {
    checkUser();
  }, []);

  const checkUser = async () => {
    try {
      const { data } = await api.get('/auth/profile');
      setUser(data);
    } catch (error) {
      setUser(null);
    } finally {
      setLoading(false);
    }
  };

  const login = async (credentials: any) => {
    await api.post('/auth/login', credentials);
    await checkUser(); // ׳¨׳¢׳ ׳•׳ ׳₪׳¨׳˜׳™ ׳”׳׳©׳×׳׳©
  };

  const register = async (data: any) => {
    await api.post('/auth/register', data);
    await checkUser();
  };

  const logout = async () => {
    await api.post('/auth/logout');
    setUser(null);
  };

  return (
    <AuthContext.Provider value={{ user, loading, login, register, logout }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\pages\CartPage.tsx
================================
import { useEffect, useState } from 'react'; 
import api from '../services/api'; // ׳ ׳ ׳™׳— ׳©׳™׳© ׳׳ ׳©׳™׳¨׳•׳× API ׳׳•׳’׳“׳¨
import { useNavigate } from 'react-router-dom'; // ׳ ׳•׳•׳˜ ׳‘׳™׳ ׳“׳₪׳™׳

interface CartItem { // ׳¡׳•׳’ ׳׳₪׳¨׳™׳˜ ׳‘׳¢׳’׳׳”
  id: number; // ׳׳–׳”׳” ׳”׳₪׳¨׳™׳˜ ׳‘׳¢׳’׳׳”
  quantity: number; // ׳›׳׳•׳× ׳”׳₪׳¨׳™׳˜
  product: { // ׳׳™׳“׳¢ ׳¢׳ ׳”׳׳•׳¦׳¨
    id: number; // ׳׳–׳”׳” ׳”׳׳•׳¦׳¨
    name: string; // ׳©׳ ׳”׳׳•׳¦׳¨
    price: number; // ׳׳—׳™׳¨ ׳”׳׳•׳¦׳¨
    imageUrl: string; // ׳›׳×׳•׳‘׳× ׳×׳׳•׳ ׳× ׳”׳׳•׳¦׳¨
  }; // ׳¡׳•׳£ ׳׳™׳“׳¢ ׳¢׳ ׳”׳׳•׳¦׳¨
} // ׳¡׳•׳£ ׳¡׳•׳’ ׳׳₪׳¨׳™׳˜ ׳‘׳¢׳’׳׳”

interface Cart { // ׳¡׳•׳’ ׳׳¢׳’׳׳”
  id: number; // ׳׳–׳”׳” ׳”׳¢׳’׳׳” 
  items: CartItem[]; // ׳¨׳©׳™׳׳× ׳”׳₪׳¨׳™׳˜׳™׳ ׳‘׳¢׳’׳׳”
  total: number; // ׳”׳¡׳›׳•׳ ׳”׳›׳•׳׳ ׳©׳ ׳”׳¢׳’׳׳”
}

export const CartPage = () => { // ׳¨׳›׳™׳‘ ׳“׳£ ׳”׳¢׳’׳׳”
  const [cart, setCart] = useState<Cart | null>(null); // ׳׳¦׳‘ ׳׳¢׳’׳׳”
  const [loading, setLoading] = useState(true); // ׳׳¦׳‘ ׳˜׳¢׳™׳ ׳”
  const navigate = useNavigate(); // ׳”׳•׳§ ׳׳ ׳™׳•׳•׳˜ ׳‘׳™׳ ׳“׳₪׳™׳

  useEffect(() => { // ׳”׳©׳₪׳¢׳” ׳׳˜׳¢׳™׳ ׳× ׳”׳¢׳’׳׳” ׳‘׳¢׳× ׳˜׳¢׳™׳ ׳× ׳”׳¨׳›׳™׳‘
    fetchCart(); // ׳§׳¨׳™׳׳” ׳׳₪׳•׳ ׳§׳¦׳™׳” ׳׳˜׳¢׳™׳ ׳× ׳”׳¢׳’׳׳”
  }, []); // ׳¨׳™׳¦׳” ׳₪׳¢׳ ׳׳—׳× ׳‘׳¢׳× ׳˜׳¢׳™׳ ׳× ׳”׳¨׳›׳™׳‘

  const fetchCart = async () => { // ׳₪׳•׳ ׳§׳¦׳™׳” ׳׳˜׳¢׳™׳ ׳× ׳”׳¢׳’׳׳”
    try { // ׳ ׳™׳¡׳™׳•׳ ׳׳©׳׳•׳£ ׳׳× ׳”׳¢׳’׳׳” ׳׳”׳©׳¨׳×
      const { data } = await api.get('/cart'); // ׳§׳¨׳™׳׳” ׳-API ׳׳§׳‘׳׳× ׳”׳¢׳’׳׳”
      setCart(data); // ׳¢׳“׳›׳•׳ ׳׳¦׳‘ ׳”׳¢׳’׳׳” ׳¢׳ ׳”׳ ׳×׳•׳ ׳™׳ ׳©׳”׳×׳§׳‘׳׳•
    } catch (error) { // ׳˜׳™׳₪׳•׳ ׳‘׳©׳’׳™׳׳” ׳‘׳׳§׳¨׳” ׳©׳ ׳›׳™׳©׳׳•׳
      console.error('Failed to fetch cart', error); // ׳”׳“׳₪׳¡׳× ׳”׳©׳’׳™׳׳” ׳׳§׳•׳ ׳¡׳•׳
    } finally { // ׳¡׳™׳•׳ ׳”׳˜׳¢׳™׳ ׳”
      setLoading(false); // ׳¢׳“׳›׳•׳ ׳׳¦׳‘ ׳”׳˜׳¢׳™׳ ׳” ׳׳¡׳™׳•׳
    } // ׳¡׳™׳•׳ ׳˜׳™׳₪׳•׳
  }; // ׳¡׳™׳•׳ ׳₪׳•׳ ׳§׳¦׳™׳” ׳׳˜׳¢׳™׳ ׳× ׳”׳¢׳’׳׳”

  const removeItem = async (itemId: number) => { // ׳₪׳•׳ ׳§׳¦׳™׳” ׳׳”׳¡׳¨׳× ׳₪׳¨׳™׳˜ ׳׳”׳¢׳’׳׳”
    try { // ׳ ׳™׳¡׳™׳•׳ ׳׳”׳¡׳™׳¨ ׳₪׳¨׳™׳˜ ׳׳”׳¢׳’׳׳”
      // ׳¢׳“׳›׳•׳ ׳׳•׳₪׳˜׳™׳׳™: ׳”׳¡׳¨׳” ׳׳”׳×׳¦׳•׳’׳” ׳׳™׳“
      setCart(prev => { // ׳¢׳“׳›׳•׳ ׳׳¦׳‘ ׳”׳¢׳’׳׳”
        if (!prev) return null; // ׳׳ ׳”׳¢׳’׳׳” ׳¨׳™׳§׳”, ׳׳ ׳׳¢׳©׳•׳× ׳›׳׳•׳
        const item = prev.items.find(i => i.id === itemId); // ׳׳¦׳™׳׳× ׳”׳₪׳¨׳™׳˜ ׳׳”׳¡׳¨׳”
        if (!item) return prev; // ׳׳ ׳”׳₪׳¨׳™׳˜ ׳׳ ׳ ׳׳¦׳, ׳׳ ׳׳¢׳©׳•׳× ׳›׳׳•׳
        return { // ׳¢׳“׳›׳•׳ ׳”׳¢׳’׳׳” ׳׳׳—׳¨ ׳”׳¡׳¨׳× ׳”׳₪׳¨׳™׳˜
          ...prev, // ׳©׳׳™׳¨׳× ׳©׳׳¨ ׳”׳׳™׳“׳¢ ׳‘׳¢׳’׳׳”
          items: prev.items.filter(i => i.id !== itemId), // ׳”׳¡׳¨׳× ׳”׳₪׳¨׳™׳˜ ׳׳”׳¨׳©׳™׳׳”
          total: prev.total - (item.product.price * item.quantity) // ׳¢׳“׳›׳•׳ ׳”׳¡׳›׳•׳ ׳”׳›׳•׳׳
        }; // ׳¡׳™׳•׳ ׳¢׳“׳›׳•׳ ׳”׳¢׳’׳׳”
      }); // ׳¡׳™׳•׳ ׳¢׳“׳›׳•׳ ׳׳¦׳‘ ׳”׳¢׳’׳׳”
      await api.delete(`/cart/${itemId}`); // ׳§׳¨׳™׳׳” ׳-API ׳׳”׳¡׳¨׳× ׳”׳₪׳¨׳™׳˜ ׳׳”׳¢׳’׳׳” ׳‘׳©׳¨׳×
    } catch (error) { // ׳˜׳™׳₪׳•׳ ׳‘׳©׳’׳™׳׳” ׳‘׳׳§׳¨׳” ׳©׳ ׳›׳™׳©׳׳•׳
      alert('׳©׳’׳™׳׳” ׳‘׳׳—׳™׳§׳× ׳₪׳¨׳™׳˜'); // ׳”׳¦׳’׳× ׳”׳•׳“׳¢׳× ׳©׳’׳™׳׳” ׳׳׳©׳×׳׳©
      fetchCart(); // ׳‘׳׳§׳¨׳” ׳©׳ ׳©׳’׳™׳׳” ׳ ׳—׳–׳™׳¨ ׳׳× ׳”׳׳¦׳‘ ׳׳§׳“׳׳•׳×׳•
    } // ׳¡׳™׳•׳ ׳˜׳™׳₪׳•׳
  }; // ׳¡׳™׳•׳ ׳₪׳•׳ ׳§׳¦׳™׳” ׳׳”׳¡׳¨׳× ׳₪׳¨׳™׳˜ ׳׳”׳¢׳’׳׳”

  const clearCart = async () => { // ׳₪׳•׳ ׳§׳¦׳™׳” ׳׳¨׳™׳§׳•׳ ׳”׳¢׳’׳׳”
    if (window.confirm('׳”׳׳ ׳׳×׳” ׳‘׳˜׳•׳— ׳©׳‘׳¨׳¦׳•׳ ׳ ׳׳¨׳•׳§׳ ׳׳× ׳”׳¢׳’׳׳”?')) { // ׳׳™׳©׳•׳¨ ׳׳”׳¨׳™׳§׳•׳
      try { // ׳ ׳™׳¡׳™׳•׳ ׳׳¨׳•׳§׳ ׳׳× ׳”׳¢׳’׳׳”
        await api.delete('/cart');    // ׳§׳¨׳™׳׳” ׳-API ׳׳¨׳™׳§׳•׳ ׳”׳¢׳’׳׳” ׳‘׳©׳¨׳×
        fetchCart(); // ׳˜׳¢׳™׳ ׳× ׳”׳¢׳’׳׳” ׳׳—׳“׳© ׳׳׳—׳¨ ׳”׳¨׳™׳§׳•׳
      } catch (error) { // ׳˜׳™׳₪׳•׳ ׳‘׳©׳’׳™׳׳” ׳‘׳׳§׳¨׳” ׳©׳ ׳›׳™׳©׳׳•׳
        alert('׳©׳’׳™׳׳” ׳‘׳¨׳™׳§׳•׳ ׳”׳¢׳’׳׳”'); // ׳”׳¦׳’׳× ׳”׳•׳“׳¢׳× ׳©׳’׳™׳׳” ׳׳׳©׳×׳׳©
      } // ׳¡׳™׳•׳ ׳˜׳™׳₪׳•׳
    } // ׳¡׳™׳•׳ ׳׳™׳©׳•׳¨ ׳׳”׳¨׳™׳§׳•׳
  }; // ׳¡׳™׳•׳ ׳₪׳•׳ ׳§׳¦׳™׳” ׳׳¨׳™׳§׳•׳ ׳”׳¢׳’׳׳”

  const checkout = async () => { // ׳₪׳•׳ ׳§׳¦׳™׳” ׳׳‘׳™׳¦׳•׳¢ ׳×׳©׳׳•׳
    try { // ׳ ׳™׳¡׳™׳•׳ ׳׳‘׳¦׳¢ ׳׳× ׳”׳×׳©׳׳•׳
      await api.post('/order'); // ׳§׳¨׳™׳׳” ׳-API ׳׳™׳¦׳™׳¨׳× ׳”׳–׳׳ ׳”
      alert('׳”׳”׳–׳׳ ׳” ׳‘׳•׳¦׳¢׳” ׳‘׳”׳¦׳׳—׳”!\n׳”׳”׳–׳׳ ׳” ׳×׳™׳©׳׳— ׳׳›׳×׳•׳‘׳× ׳¨׳©׳™ 18 ׳“׳™׳¨׳” 9 ׳¢׳™׳¨ ׳׳׳¢׳“.\n׳¢׳“ 10 ׳™׳׳™׳ ׳™׳’׳™׳¢ ׳”׳׳©׳׳•׳—, ׳ ׳¢׳“׳›׳.\n׳×׳•׳“׳” ׳©׳§׳ ׳™׳× ׳׳¦׳׳ ׳• נ‰');
      navigate('/'); // ׳—׳–׳¨׳” ׳׳“׳£ ׳”׳‘׳™׳×
    } catch (error: any) { // ׳˜׳™׳₪׳•׳ ׳‘׳©׳’׳™׳׳” ׳‘׳׳§׳¨׳” ׳©׳ ׳›׳™׳©׳׳•׳
      alert('׳©׳’׳™׳׳” ׳‘׳‘׳™׳¦׳•׳¢ ׳”׳–׳׳ ׳”: ' + (error.response?.data?.message || 'Unknown error')); // ׳”׳¦׳’׳× ׳”׳•׳“׳¢׳× ׳©׳’׳™׳׳” ׳׳׳©׳×׳׳©
    } // ׳¡׳™׳•׳ ׳˜׳™׳₪׳•׳
  }; // ׳¡׳™׳•׳ ׳₪׳•׳ ׳§׳¦׳™׳” ׳׳‘׳™׳¦׳•׳¢ ׳×׳©׳׳•׳

  if (loading) return <p>׳˜׳•׳¢׳ ׳¢׳’׳׳”...</p>; // ׳”׳¦׳’׳× ׳”׳•׳“׳¢׳× ׳˜׳¢׳™׳ ׳” ׳‘׳–׳׳ ׳”׳˜׳¢׳™׳ ׳”
  if (!cart || cart.items.length === 0) return ( // ׳׳ ׳”׳¢׳’׳׳” ׳¨׳™׳§׳”, ׳”׳¦׳’׳× ׳”׳•׳“׳¢׳× ׳¨׳™׳§׳”
    <div style={{ textAlign: 'center', marginTop: '50px' }}> // ׳׳¨׳›׳– ׳׳× ׳”׳×׳•׳›׳ ׳‘׳¢׳׳•׳“
      <h2>׳”׳¢׳’׳׳” ׳©׳׳ ׳¨׳™׳§׳” נ›’</h2> // ׳”׳•׳“׳¢׳× ׳¨׳™׳§׳”
      <button onClick={() => navigate('/')} style={{ marginTop: '20px' }}>׳—׳–׳•׳¨ ׳׳—׳ ׳•׳×</button> // ׳›׳₪׳×׳•׳¨ ׳׳—׳–׳¨׳” ׳׳—׳ ׳•׳×
    </div> // ׳¡׳™׳•׳ ׳׳¨׳›׳–
  ); // ׳¡׳™׳•׳ ׳‘׳“׳™׳§׳× ׳¢׳’׳׳” ׳¨׳™׳§׳”

  return ( // ׳”׳¦׳’׳× ׳”׳¢׳’׳׳”
    <div style={{ padding: '20px', maxWidth: '800px', margin: '0 auto' }}> // ׳׳¨׳›׳– ׳׳× ׳”׳×׳•׳›׳ ׳•׳׳•׳¡׳™׳£ ׳¨׳™׳₪׳•׳“
      <h1>׳”׳¢׳’׳׳” ׳©׳׳™</h1> // ׳›׳•׳×׳¨׳× ׳”׳“׳£
      
      <div style={{ marginTop: '20px' }}> // ׳§׳•׳ ׳˜׳™׳™׳ ׳¨ ׳׳₪׳¨׳™׳˜׳™ ׳”׳¢׳’׳׳”
        {cart.items.map((item) => ( // ׳׳•׳׳׳” ׳¢׳ ׳›׳ ׳”׳₪׳¨׳™׳˜׳™׳
          <div key={item.id} style={{ display: 'flex', alignItems: 'center', borderBottom: '1px solid #eee', padding: '15px 0' }}> // ׳₪׳¨׳™׳˜ ׳‘׳¢׳’׳׳”
            <img src={item.product.imageUrl} alt={item.product.name} style={{ width: '80px', height: '80px', objectFit: 'cover', borderRadius: '8px' }} /> // ׳×׳׳•׳ ׳× ׳”׳׳•׳¦׳¨
            <div style={{ flex: 1, marginRight: '20px' }}> // ׳§׳•׳ ׳˜׳™׳™׳ ׳¨ ׳׳׳™׳“׳¢ ׳”׳׳•׳¦׳¨
              <h3>{item.product.name}</h3> // ׳©׳ ׳”׳׳•׳¦׳¨
              <p>׳›׳׳•׳×: {item.quantity} | ׳׳—׳™׳¨ ׳™׳—׳™׳“׳”: ג‚×{item.product.price}</p> // ׳›׳׳•׳× ׳•׳׳—׳™׳¨ ׳™׳—׳™׳“׳”
            </div> // ׳¡׳™׳•׳ ׳§׳•׳ ׳˜׳™׳™׳ ׳¨ ׳׳׳™׳“׳¢ ׳”׳׳•׳¦׳¨
            <div style={{ fontWeight: 'bold', fontSize: '1.2em', marginLeft: '20px' }}> // ׳׳—׳™׳¨ ׳›׳•׳׳ ׳׳₪׳¨׳™׳˜  
              ג‚×{item.product.price * item.quantity} // ׳—׳™׳©׳•׳‘ ׳׳—׳™׳¨ ׳›׳•׳׳ ׳׳₪׳¨׳™׳˜
            </div> // ׳¡׳™׳•׳ ׳׳—׳™׳¨ ׳›׳•׳׳ ׳׳₪׳¨׳™׳˜
            <button  
              onClick={() => removeItem(item.id)} // ׳₪׳•׳ ׳§׳¦׳™׳” ׳׳”׳¡׳¨׳× ׳₪׳¨׳™׳˜ ׳׳”׳¢׳’׳׳”
              style={{ background: '#ff4444', color: 'white', border: 'none', padding: '5px 10px', borderRadius: '5px', cursor: 'pointer' }} // ׳¡׳’׳ ׳•׳ ׳”׳›׳₪׳×׳•׳¨
            > // ׳›׳₪׳×׳•׳¨ ׳׳”׳¡׳¨׳×
              ׳”׳¡׳¨
            </button> // ׳¡׳™׳•׳ ׳›׳₪׳×׳•׳¨ ׳׳”׳¡׳¨׳×
          </div> // ׳¡׳™׳•׳ ׳₪׳¨׳™׳˜ ׳‘׳¢׳’׳׳”
        ))} // ׳¡׳™׳•׳ ׳׳•׳׳׳” ׳¢׳ ׳›׳ ׳”׳₪׳¨׳™׳˜׳™׳
      </div> // ׳¡׳™׳•׳ ׳§׳•׳ ׳˜׳™׳™׳ ׳¨ ׳׳₪׳¨׳™׳˜׳™ ׳”׳¢׳’׳׳”
 
      <div style={{ marginTop: '30px', borderTop: '2px solid #333', paddingTop: '20px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}> // ׳§׳•׳ ׳˜׳™׳™׳ ׳¨ ׳׳¡׳™׳›׳•׳ ׳•׳×׳©׳׳•׳
        <h2>׳¡׳”"׳› ׳׳×׳©׳׳•׳: ג‚×{cart.total}</h2> // ׳”׳¦׳’׳× ׳”׳¡׳›׳•׳ ׳”׳›׳•׳׳ ׳׳×׳©׳׳•׳
        <div style={{ display: 'flex', gap: '10px' }}> // ׳§׳•׳ ׳˜׳™׳™׳ ׳¨ ׳׳›׳₪׳×׳•׳¨׳™ ׳₪׳¢׳•׳׳”
          <button onClick={clearCart} style={{ background: '#666', color: 'white' }}>׳¨׳•׳§׳ ׳¢׳’׳׳”</button> // ׳›׳₪׳×׳•׳¨ ׳׳¨׳™׳§׳•׳ ׳”׳¢׳’׳׳”
          <button onClick={checkout} style={{ background: '#28a745', color: 'white', fontSize: '1.1em', padding: '10px 20px' }}>׳׳×׳©׳׳•׳ (Checkout)</button> // ׳›׳₪׳×׳•׳¨ ׳׳×׳©׳׳•׳
        </div> // ׳¡׳™׳•׳ ׳§׳•׳ ׳˜׳™׳™׳ ׳¨ ׳׳›׳₪׳×׳•׳¨׳™ ׳₪׳¢׳•׳׳”
      </div> // ׳¡׳™׳•׳ ׳§׳•׳ ׳˜׳™׳™׳ ׳¨ ׳׳¡׳™׳›׳•׳ ׳•׳×׳©׳׳•׳
    </div> // ׳¡׳™׳•׳ ׳׳¨׳›׳– ׳”׳×׳•׳›׳
  ); // ׳¡׳™׳•׳ ׳”׳¦׳’׳× ׳”׳¢׳’׳׳”
}; // ׳¡׳™׳•׳ ׳¨׳›׳™׳‘ ׳“׳£ ׳”׳¢׳’׳׳”



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\pages\HomePage.tsx
================================
import { useEffect, useState } from 'react';
import api from '../services/api';
import { useAuth } from '../context/AuthContext';
import { useNavigate } from 'react-router-dom';

interface Product {
  id: number;
  name: string;
  description: string;
  price: number;
  imageUrl: string;
  stock: number;
}

export const HomePage = () => {
  const { user, logout } = useAuth();
  const [products, setProducts] = useState<Product[]>([]);
  const [loading, setLoading] = useState(true);
  const navigate = useNavigate();

  useEffect(() => {
    fetchProducts();
  }, []);

  const handleGoogleLogin = () => {
    window.location.href = 'http://localhost:3000/auth/google';
  };

  const fetchProducts = async () => {
    try {
      const { data } = await api.get('/product');
      setProducts(data);
    } catch (error) {
      console.error('Failed to fetch products', error);
    } finally {
      setLoading(false);
    }
  };

  const addToCart = async (productId: number) => {
    try {
      await api.post('/cart/add', { productId, quantity: 1 });
      alert('׳”׳׳•׳¦׳¨ ׳ ׳•׳¡׳£ ׳׳¢׳’׳׳”! נ›’');
    } catch (error) {
      alert('׳©׳’׳™׳׳” ׳‘׳”׳•׳¡׳₪׳” ׳׳¢׳’׳׳” (׳׳•׳׳™ ׳—׳¡׳¨ ׳׳׳׳™?)');
    }
  };

  const deleteProduct = async (productId: number) => {
    try {
      await api.delete(`/product/${productId}`);
      setProducts(products.filter(p => p.id !== productId));
      alert('׳”׳׳•׳¦׳¨ ׳ ׳׳—׳§ ׳‘׳”׳¦׳׳—׳”!');
    } catch (error) {
      alert('׳׳ ׳ ׳™׳×׳ ׳׳׳—׳•׳§ ׳׳× ׳”׳׳•׳¦׳¨ (׳™׳™׳×׳›׳ ׳©׳”׳•׳ ׳›׳‘׳¨ ׳ ׳¨׳›׳© ׳•׳׳•׳₪׳™׳¢ ׳‘׳”׳–׳׳ ׳•׳×)');
    }
  };

  const deleteAllProducts = async () => {
    if (window.confirm('׳”׳׳ ׳׳׳—׳•׳§ ׳׳× ׳›׳ ׳”׳׳•׳¦׳¨׳™׳ ׳‘׳—׳ ׳•׳×?')) {
        try {
       setLoading(true);
        await Promise.all(products.map(p => api.delete(`/product/${p.id}`)));
        setProducts([]);
      } catch (error) {
        alert('׳׳ ׳ ׳™׳×׳ ׳׳׳—׳•׳§ ׳—׳׳§ ׳׳”׳׳•׳¦׳¨׳™׳ (׳™׳™׳×׳›׳ ׳©׳”׳ ׳›׳‘׳¨ ׳ ׳¨׳›׳©׳• ׳•׳׳•׳₪׳™׳¢׳™׳ ׳‘׳”׳–׳׳ ׳•׳×)');
      } finally {
        setLoading(false);
        }
    }
  };

  const addDemoProducts = async () => {
    const demoProducts = [
      {
        name: "iPhone 15 Pro",
        description: "׳”׳׳™׳™׳₪׳•׳ ׳”׳—׳“׳© ׳¢׳ ׳׳¡׳’׳¨׳× ׳˜׳™׳˜׳ ׳™׳•׳ ׳•׳׳¢׳‘׳“ A17 Pro",
        price: 1500,
        imageUrl: "https://images.unsplash.com/photo-1695048133142-1a20484d2569?auto=format&fit=crop&w=500&q=60",
        stock: 1003
      },
      {
        name: "iPhone 17 Pro Max",
        description: "׳”׳׳™׳™׳₪׳•׳ ׳”׳—׳“׳© ׳¢׳ ׳׳¡׳’׳¨׳× ׳–׳”׳‘ ׳•׳׳¢׳‘׳“ A19 Pro",
        price: 800,
        imageUrl: "https://images.unsplash.com/photo-1678652197831-2d180705cd2c?auto=format&fit=crop&w=500&q=60",
        stock: 8
      },
      {
        name: "MacBook Pro",
        description: "׳׳—׳©׳‘ ׳ ׳™׳™׳“ ׳—׳–׳§ ׳‘׳׳™׳•׳—׳“ ׳׳¢׳‘׳•׳“׳” ׳•׳₪׳™׳×׳•׳—",
        price: 8999,
        imageUrl: "https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?auto=format&fit=crop&w=500&q=60",
        stock: 5
      },
      {
        name: "Sony WH-1000XM5",
        description: "׳׳•׳–׳ ׳™׳•׳× ׳‘׳™׳˜׳•׳ ׳¨׳¢׳©׳™׳ ׳”׳˜׳•׳‘׳•׳× ׳‘׳¢׳•׳׳",
        price: 1490,
        imageUrl: "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?auto=format&fit=crop&w=500&q=60",
        stock: 15
      },
      {
        name: "Nespresso Vertuo",
        description: "׳׳›׳•׳ ׳× ׳§׳₪׳” ׳׳§׳₪׳¡׳•׳׳•׳× ׳•׳¨׳˜׳•",
        price: 890,
        imageUrl: "https://images.unsplash.com/photo-1621891392476-cd0744d29631?auto=format&fit=crop&w=500&q=60",
        stock: 8
      },
      {
        name: "׳˜׳׳•׳•׳™׳–׳™׳” LG OLED55C1",
        description: "׳˜׳׳•׳•׳™׳–׳™׳” ׳—׳›׳׳” 4K ׳¢׳ ׳׳¡׳ OLED",
        price: 120,
        imageUrl: "https://images.unsplash.com/photo-1593784991095-a205069470b6?auto=format&fit=crop&w=500&q=60",
        stock: 3
      },
      {
        name: "PlayStation 5",
        description: "׳§׳•׳ ׳¡׳•׳׳× ׳”׳׳©׳—׳§׳™׳ ׳”׳—׳“׳©׳” ׳©׳ ׳¡׳•׳ ׳™",
        price: 2200,
        imageUrl: "https://images.unsplash.com/photo-1606813907291-d86efa9b94db?auto=format&fit=crop&w=500&q=60",
        stock: 3
      },
      {
        name: "׳׳—׳©׳‘ ׳׳¡׳•׳¡ ׳ ׳™׳™׳“ VivoBook",
        description: "׳׳—׳©׳‘ ׳ ׳™׳™׳“ ׳׳¡׳•׳¡ ׳§׳ ׳•׳ ׳™׳™׳“ ׳׳¢׳‘׳•׳“׳” ׳™׳•׳׳™׳•׳׳™׳×",
        price: 50,
        imageUrl: "https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?auto=format&fit=crop&w=500&q=60",
        stock: 15
      },
      {
        name: "׳׳—׳©׳‘ ׳׳¡׳•׳¡ ׳ ׳™׳™׳“ ROG Zephyrus",
        description: "׳׳—׳©׳‘ ׳ ׳™׳™׳“ ׳׳¡׳•׳¡ ׳¢׳ ׳׳¢׳‘׳“ powerful",
        price: 10,
        imageUrl: "https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?auto=format&fit=crop&w=500&q=60",
        stock: 8
      },
      {
        name: "Wireless Mouse",
        description: "׳¢׳›׳‘׳¨ ׳׳׳—׳•׳˜׳™ ׳׳¨׳’׳•׳ ׳•׳׳™",
        price: 49.90,
        imageUrl: "https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?auto=format&fit=crop&w=500&q=60",
        stock: 50
      },
      {
        name: "USB-C Cable",
        description: "׳›׳‘׳ ׳˜׳¢׳™׳ ׳” ׳׳”׳™׳¨ 2 ׳׳˜׳¨",
        price: 29.90,
        imageUrl: "https://images.unsplash.com/photo-1612815154858-60aa4c59eaa6?auto=format&fit=crop&w=500&q=60",
        stock: 100
      },
      {
        name: "Phone Case",
        description: "׳›׳™׳¡׳•׳™ ׳׳’׳ ׳©׳§׳•׳£ ׳׳׳™׳™׳₪׳•׳",
        price: 19.90,
        imageUrl: "https://images.unsplash.com/photo-1603313011101-320f26a4f6f6?auto=format&fit=crop&w=500&q=60",
        stock: 200
      },
      {
        name: "Portable Charger",
        description: "׳׳˜׳¢׳ ׳ ׳™׳™׳“ 10000mAh",
        price: 89.00,
        imageUrl: "https://images.unsplash.com/photo-1609091839311-d5365f9ff1c5?auto=format&fit=crop&w=500&q=60",
        stock: 30
      },
      {
        name: "Bluetooth Speaker",
        description: "׳¨׳׳§׳•׳ ׳‘׳׳•׳˜׳•׳¡ ׳§׳˜׳ ׳•׳¢׳•׳¦׳׳×׳™",
        price: 120.00,
        imageUrl: "https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?auto=format&fit=crop&w=500&q=60",
        stock: 40
      },
      {
        name: "Smart Watch",
        description: "׳©׳¢׳•׳ ׳—׳›׳ ׳¢׳ ׳׳“ ׳“׳•׳₪׳§",
        price: 199.00,
        imageUrl: "https://images.unsplash.com/photo-1508685096489-7aacd43bd3b1?auto=format&fit=crop&w=500&q=60",
        stock: 25
      },
      {
        name: "Gaming Keyboard",
        description: "׳׳§׳׳“׳× ׳’׳™׳™׳׳™׳ ׳’ ׳׳•׳׳¨׳×",
        price: 150.00,
        imageUrl: "https://images.unsplash.com/photo-1595225476474-87563907a212?auto=format&fit=crop&w=500&q=60",
        stock: 15
      },
      {
        name: "DJI Mini 4 Pro",
        description: "׳¨׳—׳₪׳ ׳¦׳™׳׳•׳ ׳׳×׳§׳“׳ ׳‘׳׳©׳§׳ ׳§׳",
        price: 420,
        imageUrl: "https://images.unsplash.com/photo-1579829366248-204fe8413f31?auto=format&fit=crop&w=500&q=60",
        stock: 5
      },
      {
        name: "GoPro Hero 12",
        description: "׳׳¦׳׳׳× ׳׳§׳¡׳˜׳¨׳™׳ ׳¢׳׳™׳“׳” ׳׳׳™׳",
        price: 1699,
        imageUrl: "https://images.unsplash.com/photo-1565849904461-04a58ad377e0?auto=format&fit=crop&w=500&q=60",
        stock: 12
      },
      {
        name: "Samsung 65\" 4K TV",
        description: "׳˜׳׳•׳•׳™׳–׳™׳” ׳—׳›׳׳” QLED ׳¢׳ ׳×׳׳•׳ ׳” ׳׳“׳”׳™׳׳”",
        price: 3490,
        imageUrl: "https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?auto=format&fit=crop&w=500&q=60",
        stock: 4
      },
      {
        name: "Dyson V15 Detect",
        description: "׳©׳•׳׳‘ ׳׳‘׳§ ׳׳׳—׳•׳˜׳™ ׳—׳–׳§ ׳‘׳׳™׳•׳—׳“",
        price: 290,
        imageUrl: "https://images.unsplash.com/photo-1527515673510-813d31923299?auto=format&fit=crop&w=500&q=60",
        stock: 8
      },
      {
        name: "Ninja Air Fryer",
        description: "׳¡׳™׳¨ ׳˜׳™׳’׳•׳ ׳׳׳ ׳©׳׳",
        price: 890,
        imageUrl: "https://plus.unsplash.com/premium_photo-1673545518947-ddf3240090c1?auto=format&fit=crop&w=500&q=60",
        stock: 20
      },
      {
        name: "Electric Scooter",
        description: "׳§׳•׳¨׳§׳™׳ ׳˜ ׳—׳©׳׳׳™ ׳׳×׳§׳₪׳ ׳׳¢׳™׳¨",
        price: 1500,
        imageUrl: "https://images.unsplash.com/photo-1541625602330-2277a4c46182?auto=format&fit=crop&w=500&q=60",
        stock: 10
      },
      {
        name: "Meta Quest 3",
        description: "׳׳©׳§׳₪׳™ ׳׳¦׳™׳׳•׳× ׳׳“׳•׳׳” ׳׳×׳§׳“׳׳™׳",
        price: 2400,
        imageUrl: "https://images.unsplash.com/photo-1592478411213-61535f94e0c2?auto=format&fit=crop&w=500&q=60",
        stock: 7
      },
      {
        name: "Ring Video Doorbell",
        description: "׳₪׳¢׳׳•׳ ׳“׳׳× ׳—׳›׳ ׳¢׳ ׳׳¦׳׳׳”",
        price: 399,
        imageUrl: "https://plus.unsplash.com/premium_photo-1683121710572-7723bd2e235d?auto=format&fit=crop&w=500&q=60",
        stock: 15
      },
      {
        name: "Lego Classic Set",
        description: "׳¢׳¨׳›׳× ׳׳’׳• ׳§׳׳׳¡׳™׳× ׳׳‘׳ ׳™׳™׳” ׳—׳•׳₪׳©׳™׳×",
        price: 199.00,
        imageUrl: "https://images.unsplash.com/photo-1585366119957-e9730b6d0f60?auto=format&fit=crop&w=500&q=60",
        stock: 20
      },
      {
        name: "Monopoly Board Game",
        description: "׳׳©׳—׳§ ׳”׳׳•׳— ׳”׳׳₪׳•׳¨׳¡׳ ׳׳›׳ ׳”׳׳©׳₪׳—׳”",
        price: 120.00,
        imageUrl: "https://images.unsplash.com/photo-1611996575749-79a3a250f948?auto=format&fit=crop&w=500&q=60",
        stock: 15
      },
      {
        name: "RC Racing Car",
        description: "׳׳›׳•׳ ׳™׳× ׳¢׳ ׳©׳׳˜ ׳¨׳—׳•׳§ ׳׳”׳™׳¨׳” ׳‘׳׳™׳•׳—׳“",
        price: 150.00,
        imageUrl: "https://images.unsplash.com/photo-1594787318286-3d835c1d207f?auto=format&fit=crop&w=500&q=60",
        stock: 10
      },
      {
        name: "Giant Teddy Bear",
        description: "׳“׳•׳‘׳™ ׳₪׳¨׳•׳•׳” ׳¢׳ ׳§ ׳•׳¨׳ ׳׳—׳™׳‘׳•׳§׳™׳",
        price: 79.90,
        imageUrl: "https://images.unsplash.com/photo-1556012018-50c5c0da73bf?auto=format&fit=crop&w=500&q=60",
        stock: 30
      },
      {
        name: "Puzzle 1000 Pieces",
        description: "׳₪׳׳–׳ 1000 ׳—׳׳§׳™׳ ׳©׳ ׳ ׳•׳£ ׳׳¨׳”׳™׳‘",
        price: 59.90,
        imageUrl: "https://images.unsplash.com/photo-1610415636880-684082e594d5?auto=format&fit=crop&w=500&q=60",
        stock: 25
      },
      {
        name: "Wooden Dollhouse",
        description: "׳‘׳™׳× ׳‘׳•׳‘׳•׳× ׳׳¢׳¥ ׳¢׳ ׳¨׳”׳™׳˜׳™׳",
        price: 250.00,
        imageUrl: "https://images.unsplash.com/photo-1596461404969-9ae70f2830c1?auto=format&fit=crop&w=500&q=60",
        stock: 7  
      },
      {
        name: "Kids Scooter",
        description: "׳§׳•׳¨׳§׳™׳ ׳˜ 3 ׳’׳׳’׳׳™׳ ׳׳™׳׳“׳™׳",
        price: 90.00,
        imageUrl: "https://images.unsplash.com/photo-1541625602330-2277a4c46182?auto=format&fit=crop&w=500&q=60",
        stock: 12
      }
    ];

    try {
      setLoading(true);
      await Promise.all(demoProducts.map(product => api.post('/product', product)));
      await fetchProducts();
      alert('׳׳•׳¦׳¨׳™׳ ׳ ׳•׳¡׳₪׳• ׳‘׳”׳¦׳׳—׳”!');
    } catch (error) {
      alert('׳©׳’׳™׳׳” ׳‘׳”׳•׳¡׳₪׳× ׳׳•׳¦׳¨׳™׳. ׳•׳•׳“׳ ׳©׳׳×׳” ׳׳—׳•׳‘׳¨!');
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <p style={{ textAlign: 'center', marginTop: '20px' }}>׳˜׳•׳¢׳ ׳׳•׳¦׳¨׳™׳...</p>;

  return (
    <div style={{ padding: '20px', maxWidth: '1200px', margin: '0 auto' }}>
      <header style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px', borderBottom: '1px solid #eee', paddingBottom: '20px' }}>
        <h1>׳©׳׳•׳, {user?.username || '׳׳•׳¨׳—'} נ‘‹</h1>
        {user ? (
          <div style={{ display: 'flex', gap: '10px' }}>
          <button 
            onClick={() => navigate('/cart')}
            style={{ background: '#007bff', color: 'white', border: 'none', padding: '10px 20px', borderRadius: '5px', cursor: 'pointer', fontWeight: 'bold' }}
          >
            נ›’ ׳”׳¢׳’׳׳” ׳©׳׳™
          </button>
          <button 
            onClick={() => navigate('/orders')}
            style={{ background: '#6c757d', color: 'white', border: 'none', padding: '10px 20px', borderRadius: '5px', cursor: 'pointer', fontWeight: 'bold' }}
          >
            נ“¦ ׳”׳–׳׳ ׳•׳×
          </button>
          <button 
            onClick={logout} 
            style={{ background: '#ff4444', color: 'white', border: 'none', padding: '10px 20px', borderRadius: '5px', cursor: 'pointer', fontWeight: 'bold' }}
          >
           נ‘‹ ׳”׳×׳ ׳×׳§
          </button>
          <button 
            onClick={deleteAllProducts}
            style={{ background: 'black', color: 'white', border: 'none', padding: '10px 20px', borderRadius: '5px', cursor: 'pointer', fontWeight: 'bold' }}
          >
            נ—‘ן¸ ׳׳—׳§ ׳”׳›׳
          </button>
          </div>
        ) : (
          <button 
            onClick={handleGoogleLogin}
            style={{ background: '#4285F4', color: 'white', border: 'none', padding: '10px 20px', borderRadius: '5px', cursor: 'pointer', fontWeight: 'bold' }}
          >
            G ׳”׳×׳—׳‘׳¨ ׳¢׳ Google
          </button>
        )}
            
      </header>

      <h2 style={{ marginBottom: '20px' }}>׳”׳׳•׳¦׳¨׳™׳ ׳©׳׳ ׳•</h2>
      
      {products.length === 0 ? (
        <div style={{ textAlign: 'center', marginTop: '50px' }}>
          <p>׳׳™׳ ׳׳•׳¦׳¨׳™׳ ׳‘׳—׳ ׳•׳× ׳›׳¨׳’׳¢.</p>
          <button 
            onClick={addDemoProducts}
            style={{ marginTop: '10px', background: '#28a745', color: 'white', padding: '10px 20px', border: 'none', borderRadius: '5px', cursor: 'pointer' }}
          >
            ג• ׳˜׳¢׳ ׳׳•׳¦׳¨׳™׳ ׳׳“׳•׳’׳׳”
          </button>
        </div>
      ) : (
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))', gap: '25px' }}>
          {products.map((product) => (
            <div key={product.id} style={{ border: '1px solid #ddd', padding: '15px', borderRadius: '10px', textAlign: 'center', boxShadow: '0 2px 5px rgba(0,0,0,0.05)', background: 'white', position: 'relative' }}>
              <button
                onClick={() => deleteProduct(product.id)} 
                style={{ position: 'absolute', top: '10px', left: '10px', background: 'transparent', border: 'none', cursor: 'pointer', fontSize: '1.2em' }}
                title="׳׳—׳§ ׳׳•׳¦׳¨"
              >
                נ—‘ן¸
              </button>
              {product.imageUrl ? (
                <img src={product.imageUrl} alt={product.name} style={{ width: '100%', height: '200px', objectFit: 'cover', borderRadius: '8px', marginBottom: '10px' }} />
              ) : (
                <div style={{ width: '100%', height: '200px', background: '#f0f0f0', borderRadius: '8px', marginBottom: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>׳׳™׳ ׳×׳׳•׳ ׳”</div>
              )}
              <h3 style={{ margin: '10px 0' }}>{product.name}</h3>
              <p style={{ color: '#666', fontSize: '0.9em', height: '40px', overflow: 'hidden' }}>{product.description}</p>
              <p style={{ fontWeight: 'bold', fontSize: '1.2em', color: '#2c3e50' }}>ג‚×{product.price}</p>
              
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: '15px' }}>
                <span style={{ fontSize: '0.8em', color: product.stock > 0 ? 'green' : 'red', fontWeight: 'bold' }}>
                  {product.stock > 0 ? `׳‘׳׳׳׳™: ${product.stock}` : '׳׳–׳ ׳׳”׳׳׳׳™'}
                </span>
                <button
                  onClick={() => addToCart(product.id)}
                  disabled={product.stock === 0}
                  style={{
                    padding: '8px 16px',
                    background: product.stock > 0 ? '#007bff' : '#ccc',
                    color: 'white',
                    border: 'none',
                    borderRadius: '5px',
                    cursor: product.stock > 0 ? 'pointer' : 'not-allowed',
                    transition: 'background 0.2s'
                  }}
                >
                  ׳”׳•׳¡׳£ +
                </button>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\pages\LoginPage.tsx
================================
import { useState } from 'react';
import { useAuth } from '../context/AuthContext';
import { useNavigate } from 'react-router-dom';

export const LoginPage = () => {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const { login } = useAuth();
  const navigate = useNavigate();
  const [error, setError] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await login({ username, password });
      navigate('/'); // ׳׳¢׳‘׳¨ ׳׳“׳£ ׳”׳‘׳™׳× ׳׳—׳¨׳™ ׳”׳×׳—׳‘׳¨׳•׳×
    } catch (err) {
      setError('׳©׳ ׳׳©׳×׳׳© ׳׳• ׳¡׳™׳¡׳׳” ׳©׳’׳•׳™׳™׳');
    }
  };

  return (
    <div style={{ maxWidth: '300px', margin: '50px auto', textAlign: 'center' }}>
      <h2>׳”׳×׳—׳‘׳¨׳•׳×</h2>
      <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
        <input
          type="text"
          placeholder="׳©׳ ׳׳©׳×׳׳©"
          value={username}
          onChange={(e) => setUsername(e.target.value)}
          style={{ padding: '8px' }}
        />
        <input
          type="password"
          placeholder="׳¡׳™׳¡׳׳”"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          style={{ padding: '8px' }}
        />
        <button type="submit" style={{ padding: '10px', cursor: 'pointer' }}>׳”׳×׳—׳‘׳¨</button>
      </form>
      {error && <p style={{ color: 'red' }}>{error}</p>}
    </div>
  );
};



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\pages\OrderHistoryPage.tsx
================================
import { useEffect, useState } from 'react';
import api from '../services/api';
import { useNavigate } from 'react-router-dom';

interface OrderItem {
  id: number;
  quantity: number;
  price: number;
  product: {
    name: string;
    imageUrl: string;
  };
}

interface Order {
  id: number;
  orderDate: string;
  totalAmount: number;
  items: OrderItem[];
}

export const OrderHistoryPage = () => {
  const [orders, setOrders] = useState<Order[]>([]);
  const [loading, setLoading] = useState(true);
  const navigate = useNavigate();

  useEffect(() => {
    fetchOrders();
  }, []);

  const fetchOrders = async () => {
    try {
      const { data } = await api.get('/order');
      setOrders(data);
    } catch (error) {
      console.error('Failed to fetch orders', error);
    } finally {
      setLoading(false);
    }
  };

  const deleteOrder = async (orderId: number) => {
    if (window.confirm('׳”׳׳ ׳׳׳—׳•׳§ ׳׳× ׳”׳”׳–׳׳ ׳” ׳׳”׳”׳™׳¡׳˜׳•׳¨׳™׳”?')) {
      try {
        await api.delete(`/order/${orderId}`);
        setOrders(orders.filter(o => o.id !== orderId));
      } catch (error) {
        alert('׳©׳’׳™׳׳” ׳‘׳׳—׳™׳§׳× ׳”׳”׳–׳׳ ׳”');
      }
    }
  };

  if (loading) return <p style={{ textAlign: 'center', marginTop: '20px' }}>׳˜׳•׳¢׳ ׳”׳™׳¡׳˜׳•׳¨׳™׳™׳× ׳”׳–׳׳ ׳•׳×...</p>;

  return (
    <div style={{ padding: '20px', maxWidth: '800px', margin: '0 auto' }}>
      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '30px' }}>
        <button 
          onClick={() => navigate('/')} 
          style={{ marginRight: '15px', background: 'transparent', border: '1px solid #ccc', padding: '5px 10px', borderRadius: '5px', cursor: 'pointer' }}
        >
          ג¬…ן¸ ׳—׳–׳¨׳”
        </button>
        <h1>׳”׳”׳–׳׳ ׳•׳× ׳©׳׳™ נ“¦</h1>
      </div>

      {orders.length === 0 ? (
        <p style={{ textAlign: 'center', fontSize: '1.2em', color: '#666' }}>׳¢׳“׳™׳™׳ ׳׳ ׳‘׳™׳¦׳¢׳× ׳”׳–׳׳ ׳•׳×.</p>
      ) : (
        <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
          {orders.map((order) => (
            <div key={order.id} style={{ border: '1px solid #ddd', borderRadius: '10px', padding: '20px', background: 'white', boxShadow: '0 2px 4px rgba(0,0,0,0.05)', position: 'relative' }}>
              <button 
                onClick={() => deleteOrder(order.id)}
                style={{ position: 'absolute', top: '10px', left: '10px', background: 'transparent', border: 'none', cursor: 'pointer', fontSize: '1.2em' }}
                title="׳׳—׳§ ׳”׳–׳׳ ׳”"
              >
                נ—‘ן¸
              </button>
              <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid #eee', paddingBottom: '10px', marginBottom: '10px' }}>
                <div>
                  <strong>׳”׳–׳׳ ׳” #{order.id}</strong>
                  <span style={{ margin: '0 10px', color: '#999' }}>|</span>
                  <span style={{ color: '#666' }}>{new Date(order.orderDate).toLocaleDateString('he-IL')}</span>
                </div>
                <div style={{ fontWeight: 'bold', color: '#28a745' }}>
                  ׳¡׳”"׳›: ג‚×{order.totalAmount}
                </div>
              </div>
              
              <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                {order.items.map((item) => (
                  <div key={item.id} style={{ display: 'flex', alignItems: 'center', fontSize: '0.9em' }}>
                    <div style={{ width: '40px', height: '40px', background: '#f9f9f9', borderRadius: '5px', overflow: 'hidden', marginRight: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                      {item.product?.imageUrl ? (
                        <img src={item.product.imageUrl} alt={item.product.name} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                      ) : (
                        <span style={{ fontSize: '1.2em' }}>נ–¼ן¸</span>
                      )}
                    </div>
                    <div style={{ flex: 1 }}>
                      {item.product?.name || '׳׳•׳¦׳¨ ׳©׳ ׳׳—׳§'}
                    </div>
                    <div style={{ color: '#666' }}>
                      {item.quantity} x ג‚×{item.price}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\services\api.ts
================================
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:3000', // ׳›׳×׳•׳‘׳× ׳”׳©׳¨׳× ׳©׳׳
  withCredentials: true, // ׳—׳•׳‘׳”! ׳©׳•׳׳— ׳׳× ׳”-Cookies ׳‘׳›׳ ׳‘׳§׳©׳”
});

export default api;


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\App.css
================================
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\App.tsx
================================
import './App.css'
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { LoginPage } from './pages/LoginPage';
import { HomePage } from './pages/HomePage';
import { CartPage } from './pages/CartPage';
import { OrderHistoryPage } from './pages/OrderHistoryPage';
import { useAuth } from './context/AuthContext';

function App() {
  const { user, loading } = useAuth();

  if (loading) return <p>׳˜׳•׳¢׳...</p>;

  return (
    <BrowserRouter>
      <div className="app-container">
        <Routes>
          <Route path="/login" element={!user ? <LoginPage /> : <Navigate to="/" />} />
          <Route path="/" element={user ? <HomePage /> : <Navigate to="/login" />} />
          <Route path="/cart" element={user ? <CartPage /> : <Navigate to="/login" />} />
          <Route path="/orders" element={user ? <OrderHistoryPage /> : <Navigate to="/login" />} />
        </Routes>
      </div>
    </BrowserRouter>
  )
}

export default App



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\index.css
================================
:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

body {
  margin: 0;
  display: flex;
  place-items: center;
  min-width: 320px;
  min-height: 100vh;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}
button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}

@media (prefers-color-scheme: light) {
  :root {
    color: #213547;
    background-color: #ffffff;
  }
  a:hover {
    color: #747bff;
  }
  button {
    background-color: #f9f9f9;
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\src\main.tsx
================================
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'
import { AuthProvider } from './context/AuthContext.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <AuthProvider>
      <App />
    </AuthProvider>
  </StrictMode>,
)



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\eslint.config.js
================================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\index.html
================================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>client-app</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\package.json
================================
{
  "name": "client-app",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.13.2",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\tsconfig.app.json
================================
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\tsconfig.json
================================
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\tsconfig.node.json
================================
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\client-app\vite.config.ts
================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\auth\dto\login.dto.ts
================================
// src/auth/dto/login.dto.ts
import { IsString } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

export class LoginDto {
  @ApiProperty({ example: 'user1', description: '׳©׳ ׳”׳׳©׳×׳׳©' })
  @IsString()
  username: string;

  @ApiProperty({ example: '123456', description: '׳”׳¡׳™׳¡׳׳”' })
  @IsString()
  password: string;
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\auth\guards\jwt-auth.guard.ts
================================
// c:\Users\Israel\Desktop\ג€ג€׳×׳™׳§׳™׳” ׳—׳“׳©׳”\׳׳™׳׳•׳“׳™׳\׳׳™׳׳•׳“׳™׳ ׳¢׳¨׳\Shopping_App\server-app\src\auth\guards\jwt-auth.guard.ts

import { Injectable } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';

@Injectable()
export class JwtAuthGuard extends AuthGuard('jwt') {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\auth\guards\local-auth.guard.ts
================================
// c:\Users\Israel\Desktop\ג€ג€׳×׳™׳§׳™׳” ׳—׳“׳©׳”\׳׳™׳׳•׳“׳™׳\׳׳™׳׳•׳“׳™׳ ׳¢׳¨׳\Shopping_App\server-app\src\auth\guards\local-auth.guard.ts

import { Injectable } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';

@Injectable()
export class LocalAuthGuard extends AuthGuard('local') {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\auth\strategies\google.strategy.ts
================================
import { PassportStrategy } from '@nestjs/passport';
import { Strategy, VerifyCallback } from 'passport-google-oauth20';
import { Injectable } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';

@Injectable()
export class GoogleStrategy extends PassportStrategy(Strategy, 'google') {
  constructor(configService: ConfigService) {
    super({
      clientID: configService.get<string>('GOOGLE_CLIENT_ID') || '',
      clientSecret: configService.get<string>('GOOGLE_CLIENT_SECRET') || '',
      callbackURL: configService.get<string>('GOOGLE_CALLBACK_URL') || '',
      scope: ['email', 'profile'],
    });
  }

  async validate(accessToken: string, refreshToken: string, profile: any, done: VerifyCallback): Promise<any> {
    const { name, emails, photos } = profile;
    const user = {
      email: emails[0].value,
      firstName: name.givenName,
      lastName: name.familyName,
      picture: photos[0].value,
      accessToken,
    };
    done(null, user);
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\auth\strategies\jwt.strategy.ts
================================
import { ExtractJwt, Strategy } from 'passport-jwt';
import { PassportStrategy } from '@nestjs/passport';
import { Injectable } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';
import { Request } from 'express';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
  constructor(private configService: ConfigService) {
    super({
      // ׳©׳™׳ ׳•׳™: ׳§׳¨׳™׳׳× ׳”׳˜׳•׳§׳ ׳׳”-Cookie ׳‘׳׳§׳•׳ ׳׳”-Header
      jwtFromRequest: ExtractJwt.fromExtractors([
        (request: Request) => {
          let token = null;
          if (request && request.cookies) {
            token = request.cookies['access_token'];
          }
          return token;
        },
      ]),
      ignoreExpiration: false, // ׳׳ ׳׳׳©׳¨ ׳˜׳•׳§׳ ׳©׳₪׳’ ׳×׳•׳§׳₪׳•
      secretOrKey: configService.get<string>('JWT_SECRET') || 'default_secret_key', // ׳׳•׳ ׳¢ ׳©׳’׳™׳׳× ׳˜׳™׳₪׳•׳¡׳™׳ ׳‘׳׳§׳¨׳” ׳©׳”׳׳©׳×׳ ׳” ׳׳ ׳ ׳׳¦׳
    });
  }


  async validate(payload: any) {
    // ׳׳—׳–׳™׳¨ ׳׳× ׳”׳׳™׳“׳¢ ׳©׳™׳© ׳‘׳×׳•׳ ׳”׳˜׳•׳§׳ ׳׳×׳•׳ ׳”׳׳•׳‘׳™׳™׳§׳˜ req.user
    return { userId: payload.sub, username: payload.username };
  }
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\auth\strategies\local.strategy.ts
================================
// c:\Users\Israel\Desktop\ג€ג€׳×׳™׳§׳™׳” ׳—׳“׳©׳”\׳׳™׳׳•׳“׳™׳\׳׳™׳׳•׳“׳™׳ ׳¢׳¨׳\Shopping_App\server-app\src\auth\strategies\local.strategy.ts

import { Strategy } from 'passport-local';
import { PassportStrategy } from '@nestjs/passport';
import { Injectable, UnauthorizedException } from '@nestjs/common';
import { AuthService } from '../auth.service';

@Injectable()
export class LocalStrategy extends PassportStrategy(Strategy) {
  constructor(private authService: AuthService) {
    super();
    // ׳›׳‘׳¨׳™׳¨׳× ׳׳—׳“׳ ׳׳¦׳₪׳” ׳׳©׳“׳•׳× 'username' ׳•-'password' ׳‘-Body
  }

  async validate(username: string, password: string): Promise<any> {
    const user = await this.authService.validateUser(username, password);
    if (!user) {
      throw new UnauthorizedException('׳©׳ ׳׳©׳×׳׳© ׳׳• ׳¡׳™׳¡׳׳” ׳©׳’׳•׳™׳™׳');
    }
    return user;
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\auth\auth.controller.ts
================================
import { Controller, Post, UseGuards, Body, Request, Get, Res } from '@nestjs/common';
import type { Response } from 'express';
import { LocalAuthGuard } from './guards/local-auth.guard';
import { JwtAuthGuard } from './guards/jwt-auth.guard';
import { AuthService } from './auth.service';
import { CreateUserDto } from '../users/dto/create-user.dto';
import { LoginDto } from './dto/login.dto';
import { AuthGuard } from '@nestjs/passport'; // <--- ׳™׳™׳‘׳•׳ ׳ ׳“׳¨׳© ׳¢׳‘׳•׳¨ ׳’׳•׳’׳

import { ApiTags, ApiOperation, ApiBearerAuth, ApiBody } from '@nestjs/swagger';

@ApiTags('Authentication')
@Controller('auth')
export class AuthController {
  constructor(private authService: AuthService) {}

  // ׳ ׳×׳™׳‘ ׳₪׳×׳•׳— ׳׳›׳•׳׳ - ׳”׳¨׳©׳׳”
  @Post('register')
  @ApiOperation({ summary: '׳”׳¨׳©׳׳” ׳׳׳¢׳¨׳›׳× (׳₪׳×׳•׳— ׳׳›׳•׳׳)' })
  async register(@Body() createUserDto: CreateUserDto) {
    return this.authService.register(createUserDto);
  }

  // ׳ ׳×׳™׳‘ ׳”׳×׳—׳‘׳¨׳•׳× (׳“׳•׳¨׳© ׳©׳ ׳•׳¡׳™׳¡׳׳”)
  @Post('login')
  @UseGuards(LocalAuthGuard)
  @ApiBody({ type: LoginDto })
  @ApiOperation({ summary: '׳”׳×׳—׳‘׳¨׳•׳× ׳•׳§׳‘׳׳× ׳˜׳•׳§׳' })
  async login(@Request() req, @Res({ passthrough: true }) response: Response) {
    const { access_token } = await this.authService.login(req.user);
    
    // ׳©׳׳™׳¨׳× ׳”׳˜׳•׳§׳ ׳‘-Cookie ׳׳׳•׳‘׳˜׳—
    response.cookie('access_token', access_token, {
      httpOnly: true, // ׳׳ ׳ ׳’׳™׳© ׳-JavaScript (׳׳•׳ ׳¢ XSS)
      secure: false, // ׳‘׳™׳™׳¦׳•׳¨ (Production) ׳¦׳¨׳™׳ ׳׳©׳ ׳•׳× ׳-true (׳“׳•׳¨׳© HTTPS)
      sameSite: 'lax',
      maxAge: 24 * 60 * 60 * 1000, // 24 ׳©׳¢׳•׳×
    });

    return { message: '׳”׳×׳—׳‘׳¨׳× ׳‘׳”׳¦׳׳—׳”' };
  }

  // --- ׳”׳×׳—׳‘׳¨׳•׳× ׳¢׳ ׳’׳•׳’׳ ---

  @Get('google')
  @UseGuards(AuthGuard('google'))
  @ApiOperation({ summary: '׳”׳×׳—׳׳× ׳×׳”׳׳™׳ ׳”׳×׳—׳‘׳¨׳•׳× ׳¢׳ ׳’׳•׳’׳' })
  async googleAuth(@Request() req) {
    // ׳”׳₪׳•׳ ׳§׳¦׳™׳” ׳”׳–׳• ׳׳₪׳¢׳™׳׳” ׳׳× ׳”-Guard ׳©׳ ׳’׳•׳’׳ ׳•׳׳¢׳‘׳™׳¨׳” ׳׳× ׳”׳׳©׳×׳׳© ׳׳“׳£ ׳”׳”׳×׳—׳‘׳¨׳•׳× ׳©׳ ׳’׳•׳’׳
  }

  @Get('google/callback')
  @UseGuards(AuthGuard('google'))
  @ApiOperation({ summary: '׳—׳–׳¨׳” ׳׳’׳•׳’׳, ׳™׳¦׳™׳¨׳× ׳˜׳•׳§׳ ׳•׳”׳₪׳ ׳™׳” ׳׳׳×׳¨' })
  async googleAuthRedirect(@Request() req, @Res({ passthrough: true }) response: Response) {
    // ׳§׳‘׳׳× ׳”׳˜׳•׳§׳ ׳׳”-Service (׳©׳›׳‘׳¨ ׳™׳¦׳¨/׳׳¦׳ ׳׳× ׳”׳׳©׳×׳׳©)
    const { access_token } = await this.authService.googleLogin(req);

    // ׳©׳׳™׳¨׳× ׳”׳˜׳•׳§׳ ׳‘-Cookie (׳‘׳“׳™׳•׳§ ׳›׳׳• ׳‘-login ׳¨׳’׳™׳)
    response.cookie('access_token', access_token, {
      httpOnly: true,
      secure: false,
      sameSite: 'lax',
      maxAge: 24 * 60 * 60 * 1000, // 24 ׳©׳¢׳•׳×
    });

    // ׳”׳₪׳ ׳™׳” ׳—׳–׳¨׳” ׳׳¦׳“ ׳”׳׳§׳•׳— (Frontend)
    response.redirect('http://localhost:5173');
  }

  // -----------------------

  // ׳ ׳×׳™׳‘ ׳׳•׳’׳ ׳׳‘׳“׳™׳§׳” (׳“׳•׳¨׳© ׳˜׳•׳§׳)
  @UseGuards(JwtAuthGuard)
  @ApiBearerAuth()
  @Get('profile')
  @ApiOperation({ summary: '׳§׳‘׳׳× ׳₪׳¨׳˜׳™ ׳”׳׳©׳×׳׳© ׳”׳׳—׳•׳‘׳¨' })
  getProfile(@Request() req) {
    return req.user;
  }

  @Post('logout')
  @UseGuards(JwtAuthGuard)
  @ApiOperation({ summary: '׳”׳×׳ ׳×׳§׳•׳× ׳׳”׳׳¢׳¨׳›׳× (׳׳—׳™׳§׳× ׳”-Cookie)' })
  logout(@Res({ passthrough: true }) response: Response) {
    response.clearCookie('access_token');
    return { message: '׳”׳×׳ ׳×׳§׳× ׳‘׳”׳¦׳׳—׳”' };
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\auth\auth.module.ts
================================
import { Module } from '@nestjs/common';
import { JwtModule } from '@nestjs/jwt';
import { PassportModule } from '@nestjs/passport';
import { ConfigModule, ConfigService } from '@nestjs/config';
import { AuthService } from './auth.service';
import { AuthController } from './auth.controller';
import { UsersModule } from '../users/users.module';
import { JwtStrategy } from './strategies/jwt.strategy';
import { LocalStrategy } from './strategies/local.strategy';
import { GoogleStrategy } from './strategies/google.strategy';

@Module({
  imports: [
    UsersModule,
    PassportModule,
    JwtModule.registerAsync({
      imports: [ConfigModule],
      useFactory: async (configService: ConfigService) => ({
        secret: configService.get<string>('JWT_SECRET'),
        signOptions: {
          expiresIn: '24h'
        },
      }),
      inject: [ConfigService],
    }),
  ],
  controllers: [AuthController],
  providers: [
    AuthService, 
    JwtStrategy, 
    LocalStrategy,
    GoogleStrategy // <--- ׳—׳•׳‘׳” ׳׳”׳•׳¡׳™׳£ ׳›׳׳ ׳›׳“׳™ ׳©׳”׳”׳×׳—׳‘׳¨׳•׳× ׳¢׳ ׳’׳•׳’׳ ׳×׳¢׳‘׳•׳“!
  ],
  exports: [AuthService],
})
export class AuthModule {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\auth\auth.service.ts
================================
import { Injectable, BadRequestException } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { UsersService } from '../users/users.service';
import * as bcrypt from 'bcrypt';
import { CreateUserDto } from '../users/dto/create-user.dto';

@Injectable()
export class AuthService {
  constructor(
    private usersService: UsersService, // ׳”׳–׳¨׳§׳× ׳©׳™׳¨׳•׳× ׳”׳׳©׳×׳׳©׳™׳
    private jwtService: JwtService,
  ) {}

  async validateUser(username: string, password: string): Promise<any> {
    const user = await this.usersService.findByUsername(username); // ׳—׳™׳₪׳•׳© ׳׳©׳×׳׳© ׳‘-DB
    if (user && await bcrypt.compare(password, user.password)) { // ׳‘׳“׳™׳§׳× ׳¡׳™׳¡׳׳” ׳׳•׳¦׳₪׳ ׳×
      const { password, ...result } = user; // ׳”׳¡׳¨׳× ׳”׳¡׳™׳¡׳׳” ׳׳”׳׳•׳‘׳™׳™׳§׳˜ ׳”׳׳•׳—׳–׳¨
      return result;
    }
    return null;
  }

  async googleLogin(req) {
    if (!req.user) {
      throw new BadRequestException('No user from google');
    }

    const { email, firstName, lastName } = req.user;

    // ׳‘׳“׳™׳§׳” ׳׳ ׳”׳׳©׳×׳׳© ׳§׳™׳™׳ ׳‘׳׳¢׳¨׳›׳×.
    // ׳׳ ׳• ׳׳©׳×׳׳©׳™׳ ׳‘׳׳™׳׳™׳™׳ ׳›׳©׳ ׳”׳׳©׳×׳׳© ׳׳¦׳•׳¨׳ ׳”׳–׳™׳”׳•׳™ (׳׳• findByEmail ׳׳ ׳§׳™׳™׳ ׳‘-UsersService)
    let user = await this.usersService.findByUsername(email);

    if (!user) {
      // ׳׳ ׳”׳׳©׳×׳׳© ׳׳ ׳§׳™׳™׳ - ׳ ׳™׳¦׳•׳¨ ׳׳•׳×׳•
      const randomPassword = Math.random().toString(36).slice(-8); // ׳™׳¦׳™׳¨׳× ׳¡׳™׳¡׳׳” ׳¨׳ ׳“׳•׳׳׳™׳×
      
      const newUserDto: CreateUserDto = {
        username: email, // ׳©׳™׳׳•׳© ׳‘׳׳™׳׳™׳™׳ ׳›׳©׳ ׳׳©׳×׳׳©
        email: email,
        password: randomPassword,
        // ׳ ׳™׳×׳ ׳׳”׳•׳¡׳™׳£ ׳©׳“׳•׳× ׳ ׳•׳¡׳₪׳™׳ ׳׳ ׳”-DTO ׳×׳•׳׳ ׳‘׳”׳ (׳›׳׳• firstName, lastName)
      };

      user = await this.usersService.create(newUserDto);
    }

    // ׳”׳—׳–׳¨׳× JWT (׳‘׳™׳¦׳•׳¢ Login)
    return this.login(user);
  }

  async login(user: any) {
    const payload = { username: user.username, sub: user.id }; // ׳™׳¦׳™׳¨׳× ׳”-Payload
    return {
      access_token: this.jwtService.sign(payload), // ׳—׳×׳™׳׳” ׳¢׳ ׳”׳˜׳•׳§׳
    };
  }

  // --- ׳”׳₪׳•׳ ׳§׳¦׳™׳” ׳”׳—׳“׳©׳” ׳׳”׳¨׳©׳׳” ---
  async register(createUserDto: CreateUserDto) {
    // 1. ׳™׳¦׳™׳¨׳× ׳”׳׳©׳×׳׳© ׳‘-DB
    const newUser = await this.usersService.create(createUserDto);
    
    // 2. ׳‘׳™׳¦׳•׳¢ Login ׳׳•׳˜׳•׳׳˜׳™ (׳”׳—׳–׳¨׳× ׳˜׳•׳§׳)
    return this.login(newUser);
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart\dto\add-to-cart.dto.ts
================================
import { IsNumber, Min } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

export class AddToCartDto {
  @ApiProperty({ example: 1, description: 'ID ׳©׳ ׳”׳׳•׳¦׳¨' })
  @IsNumber()
  productId: number;

  @ApiProperty({ example: 1, description: '׳›׳׳•׳×' })
  @IsNumber()
  @Min(1)
  quantity: number;
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart\dto\create-cart.dto.ts
================================
export class CreateCartDto {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart\dto\update-cart.dto.ts
================================
import { PartialType } from '@nestjs/mapped-types';
import { CreateCartDto } from './create-cart.dto';

export class UpdateCartDto extends PartialType(CreateCartDto) {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart\entities\cart.entity.ts
================================
import { Entity, PrimaryGeneratedColumn, OneToOne, OneToMany, JoinColumn, CreateDateColumn, UpdateDateColumn } from 'typeorm';
import { User } from '../../users/entities/user.entity';
import { CartItem } from '../../cart-item/entities/cart-item.entity';

@Entity('carts')
export class Cart {
  @PrimaryGeneratedColumn()
  id: number;

  // ׳§׳™׳©׳•׳¨ ׳׳׳©׳×׳׳© (׳¢׳’׳׳” ׳׳—׳× ׳׳׳©׳×׳׳© ׳׳—׳“)
  @OneToOne(() => User, (user) => user.carts)
  @JoinColumn()
  user: User;

  // ׳§׳™׳©׳•׳¨ ׳׳₪׳¨׳™׳˜׳™׳ (׳¢׳’׳׳” ׳׳—׳× ׳׳›׳™׳׳” ׳”׳¨׳‘׳” ׳₪׳¨׳™׳˜׳™׳)
  @OneToMany(() => CartItem, (cartItem) => cartItem.cart)
  items: CartItem[];

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart\cart.controller.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { CartController } from './cart.controller';
import { CartService } from './cart.service';

describe('CartController', () => {
  let controller: CartController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [CartController],
      providers: [CartService],
    }).compile();

    controller = module.get<CartController>(CartController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart\cart.controller.ts
================================
import { Controller, Get, Post, Body, Delete, Param, UseGuards, Request } from '@nestjs/common';
import { CartService } from './cart.service';
import { AddToCartDto } from './dto/add-to-cart.dto';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';
import { ApiTags, ApiOperation, ApiBearerAuth } from '@nestjs/swagger';

@ApiTags('Cart')
@UseGuards(JwtAuthGuard) // ׳›׳ ׳”׳₪׳¢׳•׳׳•׳× ׳‘׳¢׳’׳׳” ׳“׳•׳¨׳©׳•׳× ׳”׳×׳—׳‘׳¨׳•׳×
@ApiBearerAuth()
@Controller('cart')
export class CartController {
  constructor(private readonly cartService: CartService) {}

  @Get()
  @ApiOperation({ summary: '׳§׳‘׳׳× ׳”׳¢׳’׳׳” ׳©׳ ׳”׳׳©׳×׳׳© ׳”׳ ׳•׳›׳—׳™' })
  getCart(@Request() req) {
    return this.cartService.getCart(req.user.userId);
  }

  @Post('add')
  @ApiOperation({ summary: '׳”׳•׳¡׳₪׳× ׳׳•׳¦׳¨ ׳׳¢׳’׳׳”' })
  addToCart(@Request() req, @Body() addToCartDto: AddToCartDto) {
    return this.cartService.addToCart(req.user.userId, addToCartDto);
  }

  @Delete(':itemId')
  @ApiOperation({ summary: '׳׳—׳™׳§׳× ׳₪׳¨׳™׳˜ ׳׳”׳¢׳’׳׳”' })
  removeFromCart(@Request() req, @Param('itemId') itemId: string) {
    return this.cartService.removeFromCart(req.user.userId, +itemId);
  }

  @Delete()
  @ApiOperation({ summary: '׳¨׳™׳§׳•׳ ׳”׳¢׳’׳׳”' })
  clearCart(@Request() req) {
    return this.cartService.clearCart(req.user.userId);
  }
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart\cart.module.ts
================================
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { CartService } from './cart.service';
import { CartController } from './cart.controller';
import { Cart } from './entities/cart.entity';
import { CartItem } from '../cart-item/entities/cart-item.entity';
import { Product } from '../product/entities/product.entity';

@Module({
  imports: [TypeOrmModule.forFeature([Cart, CartItem, Product])],
  controllers: [CartController],
  providers: [CartService],
  exports: [CartService]
})
export class CartModule {}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart\cart.service.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { CartService } from './cart.service';

describe('CartService', () => {
  let service: CartService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [CartService],
    }).compile();

    service = module.get<CartService>(CartService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart\cart.service.ts
================================
import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Cart } from './entities/cart.entity';
import { CartItem } from '../cart-item/entities/cart-item.entity';
import { Product } from '../product/entities/product.entity';
import { AddToCartDto } from './dto/add-to-cart.dto';

@Injectable()
export class CartService {
  constructor(
    @InjectRepository(Cart)
    private cartRepository: Repository<Cart>,
    @InjectRepository(CartItem)
    private cartItemRepository: Repository<CartItem>,
    @InjectRepository(Product)
    private productRepository: Repository<Product>,
  ) {}

  async getCart(userId: number) {
    let cart = await this.cartRepository.findOne({
      where: { user: { id: userId } },
      relations: ['items', 'items.product'], // ׳׳‘׳™׳ ׳’׳ ׳׳× ׳”׳₪׳¨׳™׳˜׳™׳ ׳•׳’׳ ׳׳× ׳₪׳¨׳˜׳™ ׳”׳׳•׳¦׳¨
    });

    if (!cart) {
      // ׳׳ ׳׳™׳ ׳¢׳’׳׳” ׳׳׳©׳×׳׳©, ׳ ׳™׳¦׳•׳¨ ׳׳—׳× ׳—׳“׳©׳”
      cart = this.cartRepository.create({ user: { id: userId } });
      await this.cartRepository.save(cart);
      cart.items = [];
    }

    return this.calculateCartTotal(cart);
  }

  async addToCart(userId: number, addToCartDto: AddToCartDto) {
    const { productId, quantity } = addToCartDto;
    const cart = await this.getCart(userId);
    const product = await this.productRepository.findOne({ where: { id: productId } });

    if (!product) {
      throw new NotFoundException('Product not found');
    }

    // ׳‘׳“׳™׳§׳” ׳”׳׳ ׳”׳׳•׳¦׳¨ ׳›׳‘׳¨ ׳§׳™׳™׳ ׳‘׳¢׳’׳׳”
    let cartItem = await this.cartItemRepository.findOne({
      where: { cart: { id: cart.id }, product: { id: productId } },
    });

    if (cartItem) {
      // ׳׳ ׳§׳™׳™׳ - ׳ ׳¢׳“׳›׳ ׳›׳׳•׳×
      cartItem.quantity += quantity;
    } else {
      // ׳׳ ׳׳ ׳§׳™׳™׳ - ׳ ׳™׳¦׳•׳¨ ׳—׳“׳©
      cartItem = this.cartItemRepository.create({
        cart,
        product,
        quantity,
      });
    }

    await this.cartItemRepository.save(cartItem);
    return this.getCart(userId); // ׳׳—׳–׳™׳¨ ׳׳× ׳”׳¢׳’׳׳” ׳”׳׳¢׳•׳“׳›׳ ׳×
  }

  async removeFromCart(userId: number, cartItemId: number) {
    const cart = await this.getCart(userId);
    
    // ׳׳—׳™׳§׳× ׳”׳₪׳¨׳™׳˜ (׳¨׳§ ׳׳ ׳”׳•׳ ׳©׳™׳™׳ ׳׳¢׳’׳׳” ׳©׳ ׳”׳׳©׳×׳׳©)
    await this.cartItemRepository.delete({ id: cartItemId, cart: { id: cart.id } });
    
    return this.getCart(userId);
  }

  async clearCart(userId: number) {
    const cart = await this.getCart(userId);
    await this.cartItemRepository.delete({ cart: { id: cart.id } });
    return this.getCart(userId);
  }

  private calculateCartTotal(cart: Cart) {
    const total = cart.items.reduce((sum, item) => {
      return sum + (Number(item.product.price) * item.quantity);
    }, 0);
    return { ...cart, total }; // ׳׳—׳–׳™׳¨ ׳׳× ׳”׳¢׳’׳׳” ׳¢׳ ׳©׳“׳” total ׳׳—׳•׳©׳‘
  }
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart-item\dto\create-cart-item.dto.ts
================================
export class CreateCartItemDto {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart-item\dto\update-cart-item.dto.ts
================================
import { PartialType } from '@nestjs/mapped-types';
import { CreateCartItemDto } from './create-cart-item.dto';

export class UpdateCartItemDto extends PartialType(CreateCartItemDto) {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart-item\entities\cart-item.entity.ts
================================
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne } from 'typeorm';
import { Cart } from '../../cart/entities/cart.entity';
import { Product } from '../../product/entities/product.entity';

@Entity('cart_items')
export class CartItem {
  @PrimaryGeneratedColumn()
  id: number;

  @Column({ default: 1 })
  quantity: number;

  // ׳§׳™׳©׳•׳¨ ׳׳¢׳’׳׳” (׳”׳¨׳‘׳” ׳₪׳¨׳™׳˜׳™׳ ׳׳¢׳’׳׳” ׳׳—׳×)
  @ManyToOne(() => Cart, (cart) => cart.items, { onDelete: 'CASCADE' })
  cart: Cart;

  // ׳§׳™׳©׳•׳¨ ׳׳׳•׳¦׳¨ (׳”׳¨׳‘׳” ׳₪׳¨׳™׳˜׳™׳ ׳™׳›׳•׳׳™׳ ׳׳”׳¦׳‘׳™׳¢ ׳¢׳ ׳׳•׳×׳• ׳׳•׳¦׳¨ ׳‘׳¢׳’׳׳•׳× ׳©׳•׳ ׳•׳×)
  @ManyToOne(() => Product, { eager: true }) // eager: true ׳׳‘׳™׳ ׳׳× ׳₪׳¨׳˜׳™ ׳”׳׳•׳¦׳¨ ׳׳•׳˜׳•׳׳˜׳™׳× ׳›׳©׳©׳•׳׳₪׳™׳ ׳׳× ׳”׳₪׳¨׳™׳˜
  product: Product;
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart-item\cart-item.controller.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { CartItemController } from './cart-item.controller';
import { CartItemService } from './cart-item.service';

describe('CartItemController', () => {
  let controller: CartItemController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [CartItemController],
      providers: [CartItemService],
    }).compile();

    controller = module.get<CartItemController>(CartItemController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart-item\cart-item.controller.ts
================================
import { Controller, Get, Post, Body, Patch, Param, Delete } from '@nestjs/common';
import { CartItemService } from './cart-item.service';
import { CreateCartItemDto } from './dto/create-cart-item.dto';
import { UpdateCartItemDto } from './dto/update-cart-item.dto';

@Controller('cart-item')
export class CartItemController {
  constructor(private readonly cartItemService: CartItemService) {}

  @Post()
  create(@Body() createCartItemDto: CreateCartItemDto) {
    return this.cartItemService.create(createCartItemDto);
  }

  @Get()
  findAll() {
    return this.cartItemService.findAll();
  }

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.cartItemService.findOne(+id);
  }

  @Patch(':id')
  update(@Param('id') id: string, @Body() updateCartItemDto: UpdateCartItemDto) {
    return this.cartItemService.update(+id, updateCartItemDto);
  }

  @Delete(':id')
  remove(@Param('id') id: string) {
    return this.cartItemService.remove(+id);
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart-item\cart-item.module.ts
================================
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { CartItem } from './entities/cart-item.entity';

import { CartItemService } from './cart-item.service';
import { CartItemController } from './cart-item.controller';

@Module({
  imports: [TypeOrmModule.forFeature([CartItem])],
  controllers: [CartItemController],
  providers: [CartItemService],
})
export class CartItemModule {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart-item\cart-item.service.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { CartItemService } from './cart-item.service';

describe('CartItemService', () => {
  let service: CartItemService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [CartItemService],
    }).compile();

    service = module.get<CartItemService>(CartItemService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\cart-item\cart-item.service.ts
================================
import { Injectable } from '@nestjs/common';
import { CreateCartItemDto } from './dto/create-cart-item.dto';
import { UpdateCartItemDto } from './dto/update-cart-item.dto';

@Injectable()
export class CartItemService {
  create(createCartItemDto: CreateCartItemDto) {
    return 'This action adds a new cartItem';
  }

  findAll() {
    return `This action returns all cartItem`;
  }

  findOne(id: number) {
    return `This action returns a #${id} cartItem`;
  }

  update(id: number, updateCartItemDto: UpdateCartItemDto) {
    return `This action updates a #${id} cartItem`;
  }

  remove(id: number) {
    return `This action removes a #${id} cartItem`;
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order\dto\create-order.dto.ts
================================
export class CreateOrderDto {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order\dto\update-order.dto.ts
================================
import { PartialType } from '@nestjs/mapped-types';
import { CreateOrderDto } from './create-order.dto';

export class UpdateOrderDto extends PartialType(CreateOrderDto) {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order\entities\order.entity.ts
================================
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne, OneToMany, CreateDateColumn } from 'typeorm';
import { User } from '../../users/entities/user.entity';
import { OrderItem } from '../../order-item/entities/order-item.entity';

@Entity('orders')
export class Order {
  @PrimaryGeneratedColumn()
  id: number;

  @CreateDateColumn()
  orderDate: Date;

  @Column('decimal', { precision: 10, scale: 2 })
  totalAmount: number;

  @ManyToOne(() => User, (user) => user.orders)
  user: User;

  @OneToMany(() => OrderItem, (orderItem) => orderItem.order)
  items: OrderItem[];
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order\order.controller.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { OrderController } from './order.controller';
import { OrderService } from './order.service';

describe('OrderController', () => {
  let controller: OrderController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [OrderController],
      providers: [OrderService],
    }).compile();

    controller = module.get<OrderController>(OrderController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order\order.controller.ts
================================
import { Controller, Get, Post, Param, UseGuards, Request, Delete } from '@nestjs/common';
import { OrderService } from './order.service';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';
import { ApiTags, ApiOperation, ApiBearerAuth } from '@nestjs/swagger';

@ApiTags('Orders')
@UseGuards(JwtAuthGuard)
@ApiBearerAuth()
@Controller('order')
export class OrderController {
  constructor(private readonly orderService: OrderService) {}

  @Post()
  @ApiOperation({ summary: '׳‘׳™׳¦׳•׳¢ ׳”׳–׳׳ ׳” (Checkout) ׳׳”׳¢׳’׳׳” ׳”׳ ׳•׳›׳—׳™׳×' })
  create(@Request() req) {
    return this.orderService.create(req.user.userId);
  }

  @Get()
  @ApiOperation({ summary: '׳§׳‘׳׳× ׳”׳™׳¡׳˜׳•׳¨׳™׳™׳× ׳”׳–׳׳ ׳•׳×' })
  findAll(@Request() req) {
    return this.orderService.findAll(req.user.userId);
  }

  @Get(':id')
  @ApiOperation({ summary: '׳§׳‘׳׳× ׳₪׳¨׳˜׳™ ׳”׳–׳׳ ׳” ׳¡׳₪׳¦׳™׳₪׳™׳×' })
  findOne(@Param('id') id: string) {
    return this.orderService.findOne(+id);
  }

  @Delete(':id')
  @ApiOperation({ summary: '׳׳—׳™׳§׳× ׳”׳–׳׳ ׳” ׳׳”׳”׳™׳¡׳˜׳•׳¨׳™׳”' })
  remove(@Param('id') id: string, @Request() req) {
    return this.orderService.remove(+id, req.user.userId);
  }
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order\order.module.ts
================================
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { OrderService } from './order.service';
import { OrderController } from './order.controller';
import { Order } from './entities/order.entity';
import { OrderItem } from '../order-item/entities/order-item.entity';
import { Product } from '../product/entities/product.entity';
import { CartModule } from '../cart/cart.module'; // ׳—׳©׳•׳‘: ׳™׳™׳‘׳•׳ ׳”׳׳•׳“׳•׳ ׳©׳ ׳”׳¢׳’׳׳”

@Module({
  imports: [
    TypeOrmModule.forFeature([Order, OrderItem, Product]),
    CartModule, 
  ],
  controllers: [OrderController],
  providers: [OrderService],
})
export class OrderModule {}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order\order.service.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { OrderService } from './order.service';

describe('OrderService', () => {
  let service: OrderService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [OrderService],
    }).compile();

    service = module.get<OrderService>(OrderService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order\order.service.ts
================================
import { Injectable, BadRequestException, NotFoundException } from '@nestjs/common'; // ׳™׳™׳‘׳•׳ ׳׳•׳“׳•׳׳™׳ ׳•׳©׳™׳¨׳•׳×׳™׳ ׳ ׳—׳•׳¦׳™׳
import { InjectRepository } from '@nestjs/typeorm';  // ׳™׳™׳‘׳•׳ ׳©׳ TypeORM Repository
import { Repository, DataSource } from 'typeorm'; // ׳™׳™׳‘׳•׳ ׳©׳ ׳™׳©׳•׳™׳•׳× TypeORM
import { Order } from './entities/order.entity'; // ׳™׳™׳‘׳•׳ ׳™׳©׳•׳× ׳”׳”׳–׳׳ ׳”
import { OrderItem } from '../order-item/entities/order-item.entity'; // ׳™׳™׳‘׳•׳ ׳™׳©׳•׳× ׳₪׳¨׳™׳˜ ׳”׳”׳–׳׳ ׳”
import { Product } from '../product/entities/product.entity'; // ׳™׳™׳‘׳•׳ ׳™׳©׳•׳× ׳”׳׳•׳¦׳¨
import { CartService } from '../cart/cart.service'; // ׳™׳™׳‘׳•׳ ׳©׳™׳¨׳•׳× ׳”׳¢׳’׳׳”
import { User } from '../users/entities/user.entity'; // ׳™׳™׳‘׳•׳ ׳™׳©׳•׳× ׳”׳׳©׳×׳׳©

@Injectable() // ׳¡׳™׳׳•׳ ׳”׳׳—׳׳§׳” ׳›׳©׳™׳¨׳•׳× ׳©׳ ׳™׳×׳ ׳׳”׳–׳¨׳™׳§
export class OrderService { // ׳”׳’׳“׳¨׳× ׳׳—׳׳§׳× ׳©׳™׳¨׳•׳× ׳”׳”׳–׳׳ ׳•׳×
  constructor( // ׳”׳–׳¨׳§׳× ׳×׳׳•׳™׳•׳× ׳“׳¨׳ ׳”׳§׳•׳ ׳¡׳˜׳¨׳§׳˜׳•׳¨  
    @InjectRepository(Order) // ׳”׳–׳¨׳§׳× ׳¨׳₪׳•׳–׳™׳˜׳•׳¨׳™ ׳©׳ ׳”׳–׳׳ ׳•׳×
    private orderRepository: Repository<Order>, // ׳¨׳₪׳•׳–׳™׳˜׳•׳¨׳™ ׳׳”׳–׳׳ ׳•׳×
    @InjectRepository(OrderItem) // ׳”׳–׳¨׳§׳× ׳¨׳₪׳•׳–׳™׳˜׳•׳¨׳™ ׳©׳ ׳₪׳¨׳™׳˜׳™ ׳”׳–׳׳ ׳•׳×
    private orderItemRepository: Repository<OrderItem>, // ׳¨׳₪׳•׳–׳™׳˜׳•׳¨׳™ ׳׳₪׳¨׳™׳˜׳™ ׳”׳–׳׳ ׳•׳×
    @InjectRepository(Product) // ׳”׳–׳¨׳§׳× ׳¨׳₪׳•׳–׳™׳˜׳•׳¨׳™ ׳©׳ ׳׳•׳¦׳¨׳™׳
    private productRepository: Repository<Product>, // ׳¨׳₪׳•׳–׳™׳˜׳•׳¨׳™ ׳׳׳•׳¦׳¨׳™׳
    private cartService: CartService, // ׳”׳–׳¨׳§׳× ׳©׳™׳¨׳•׳× ׳”׳¢׳’׳׳”
    private dataSource: DataSource, // ׳”׳–׳¨׳§׳× ׳׳§׳•׳¨ ׳”׳ ׳×׳•׳ ׳™׳ ׳©׳ TypeORM
  ) {} // ׳¡׳™׳•׳ ׳”׳§׳•׳ ׳¡׳˜׳¨׳§׳˜׳•׳¨

  async create(userId: number) { // ׳™׳¦׳™׳¨׳× ׳”׳–׳׳ ׳” ׳—׳“׳©׳” ׳¢׳‘׳•׳¨ ׳׳©׳×׳׳© ׳׳¡׳•׳™׳ 
    const cart = await this.cartService.getCart(userId); // ׳©׳׳™׳₪׳× ׳”׳¢׳’׳׳” ׳©׳ ׳”׳׳©׳×׳׳©

    if (!cart || cart.items.length === 0) { // ׳‘׳“׳™׳§׳× ׳§׳™׳•׳ ׳”׳¢׳’׳׳” 
      throw new BadRequestException('Cart is empty');  // ׳–׳¨׳™׳§׳× ׳©׳’׳™׳׳” ׳׳ ׳”׳¢׳’׳׳” ׳¨׳™׳§׳” 
    } // ׳”׳×׳—׳׳× ׳˜׳¨׳ ׳–׳§׳¦׳™׳”

    // ׳©׳™׳׳•׳© ׳‘׳˜׳¨׳ ׳–׳§׳¦׳™׳” ׳›׳“׳™ ׳׳׳ ׳•׳¢ Race Conditions (׳׳›׳™׳¨׳× ׳™׳×׳¨)
    const orderId = await this.dataSource.transaction(async (manager) => { // ׳”׳×׳—׳׳× ׳”׳˜׳¨׳ ׳–׳§׳¦׳™׳”
      // 1. ׳©׳׳™׳₪׳× ׳”׳׳•׳¦׳¨׳™׳ ׳¢׳ ׳ ׳¢׳™׳׳” (Lock) // ׳©׳׳™׳₪׳× ׳›׳ ׳”׳׳•׳¦׳¨׳™׳ ׳‘׳¢׳’׳׳” ׳¢׳ ׳ ׳¢׳™׳׳” ׳›׳“׳™ ׳׳׳ ׳•׳¢ ׳©׳™׳ ׳•׳™׳™׳ ׳‘׳׳׳׳™
      const productIds = cart.items.map((item) => item.product.id); // ׳§׳‘׳׳× ׳׳–׳”׳™ ׳”׳׳•׳¦׳¨׳™׳ ׳©׳‘׳¢׳’׳׳”
      const products = await manager  // ׳—׳™׳₪׳•׳© ׳”׳׳•׳¦׳¨׳™׳
        .createQueryBuilder(Product, 'product') // ׳™׳¦׳™׳¨׳× ׳©׳׳™׳׳×׳” ׳¢׳ ׳™׳©׳•׳× ׳”׳׳•׳¦׳¨
        .where('product.id IN (:...ids)', { ids: productIds }) // ׳¡׳™׳ ׳•׳ ׳׳₪׳™ ׳׳–׳”׳™ ׳”׳׳•׳¦׳¨׳™׳
        .setLock('pessimistic_write') // ׳ ׳¢׳™׳׳” ׳§׳¨׳™׳˜׳™׳×!
        .getMany(); // ׳‘׳™׳¦׳•׳¢ ׳”׳©׳׳™׳׳×׳” ׳•׳§׳‘׳׳× ׳”׳׳•׳¦׳¨׳™׳

      // 2. ׳‘׳“׳™׳§׳× ׳׳׳׳™ ׳•׳—׳™׳©׳•׳‘ ׳¡׳›׳•׳
      let totalAmount = 0; // ׳׳©׳×׳ ׳” ׳׳׳—׳¡׳•׳ ׳”׳¡׳›׳•׳ ׳”׳›׳•׳׳ ׳©׳ ׳”׳”׳–׳׳ ׳”
      
      for (const item of cart.items) { // ׳׳¢׳‘׳¨ ׳¢׳ ׳›׳ ׳₪׳¨׳™׳˜׳™ ׳”׳¢׳’׳׳”
        const product = products.find((p) => p.id === item.product.id);// ׳׳¦׳™׳׳× ׳”׳׳•׳¦׳¨ ׳”׳׳×׳׳™׳
        
        if (!product) {
           throw new NotFoundException(`Product ${item.product.name} not found`);// ׳‘׳“׳™׳§׳× ׳§׳™׳•׳ ׳”׳׳•׳¦׳¨
        }
        
        if (product.stock < item.quantity) {
          throw new BadRequestException(`Not enough stock for product ${product.name}`);// ׳‘׳“׳™׳§׳× ׳׳׳׳™
        }

        totalAmount += Number(product.price) * item.quantity;// ׳—׳™׳©׳•׳‘ ׳¡׳›׳•׳ ׳›׳•׳׳
      }

      // 3. ׳™׳¦׳™׳¨׳× ׳”׳”׳–׳׳ ׳”
      const order = manager.create(Order, {// ׳™׳¦׳™׳¨׳× ׳™׳©׳•׳× ׳”׳–׳׳ ׳” ׳—׳“׳©׳”
        user: { id: userId } as User,// ׳©׳™׳•׳ ׳”׳׳©׳×׳׳©
        totalAmount,
      });
      const savedOrder = await manager.save(order); // ׳©׳׳™׳¨׳× ׳”׳”׳–׳׳ ׳” ׳‘׳׳¡׳“ ׳”׳ ׳×׳•׳ ׳™׳

      // 4. ׳™׳¦׳™׳¨׳× ׳”׳₪׳¨׳™׳˜׳™׳ ׳•׳¢׳“׳›׳•׳ ׳”׳׳׳׳™
      for (const item of cart.items) {
        const product = products.find((p) => p.id === item.product.id); // ׳׳¦׳™׳׳× ׳”׳׳•׳¦׳¨ ׳”׳׳×׳׳™׳
        
        if (!product) { // ׳‘׳“׳™׳§׳× ׳§׳™׳•׳ ׳”׳׳•׳¦׳¨
          throw new NotFoundException(`Product ${item.product.name} not found`); // ׳‘׳“׳™׳§׳× ׳§׳™׳•׳ ׳”׳׳•׳¦׳¨
        }

        const orderItem = manager.create(OrderItem, { // ׳™׳¦׳™׳¨׳× ׳”׳₪׳¨׳™׳˜ ׳׳”׳–׳׳ ׳”
          order: savedOrder, // ׳©׳™׳•׳ ׳׳”׳–׳׳ ׳”
          product: product, // ׳©׳™׳•׳ ׳׳׳•׳¦׳¨
          quantity: item.quantity, // ׳›׳׳•׳×
          price: product.price, // ׳׳—׳™׳¨ ׳™׳—׳™׳“׳”
        });
        await manager.save(orderItem); // ׳©׳׳™׳¨׳× ׳₪׳¨׳™׳˜ ׳”׳”׳–׳׳ ׳” ׳‘׳׳¡׳“ ׳”׳ ׳×׳•׳ ׳™׳

        // ׳¢׳“׳›׳•׳ ׳”׳׳׳׳™

        product.stock -= item.quantity; // ׳”׳₪׳—׳×׳× ׳”׳׳׳׳™
        await manager.save(product); // ׳©׳׳™׳¨׳× ׳”׳¢׳“׳›׳•׳ ׳‘׳׳¡׳“ ׳”׳ ׳×׳•׳ ׳™׳
      }

      // 5. ׳¨׳™׳§׳•׳ ׳”׳¢׳’׳׳”
      await this.cartService.clearCart(userId); // ׳¨׳™׳§׳•׳ ׳”׳¢׳’׳׳” ׳׳׳—׳¨ ׳™׳¦׳™׳¨׳× ׳”׳”׳–׳׳ ׳”

      return savedOrder.id; // ׳”׳—׳–׳¨׳× ׳׳–׳”׳” ׳”׳”׳–׳׳ ׳” ׳©׳ ׳•׳¦׳¨׳”
    }); // ׳¡׳™׳•׳ ׳”׳˜׳¨׳ ׳–׳§׳¦׳™׳”

    return this.findOne(orderId); // ׳”׳—׳–׳¨׳× ׳₪׳¨׳˜׳™ ׳”׳”׳–׳׳ ׳” ׳©׳ ׳•׳¦׳¨׳”
  }

  async findAll(userId: number) { // ׳©׳׳™׳₪׳× ׳›׳ ׳”׳”׳–׳׳ ׳•׳× ׳©׳ ׳׳©׳×׳׳© ׳׳¡׳•׳™׳
    return this.orderRepository.find({ // ׳—׳™׳₪׳•׳© ׳”׳”׳–׳׳ ׳•׳× ׳‘׳׳¡׳“ ׳”׳ ׳×׳•׳ ׳™׳
      where: { user: { id: userId } }, // ׳¡׳™׳ ׳•׳ ׳׳₪׳™ ׳׳–׳”׳” ׳”׳׳©׳×׳׳©
      relations: ['items', 'items.product'],// ׳˜׳¢׳™׳ ׳× ׳”׳§׳©׳¨׳™׳ ׳©׳ ׳₪׳¨׳™׳˜׳™ ׳”׳”׳–׳׳ ׳” ׳•׳”׳׳•׳¦׳¨׳™׳
      order: { orderDate: 'DESC' } // ׳׳™׳•׳ ׳׳₪׳™ ׳×׳׳¨׳™׳ ׳”׳–׳׳ ׳” ׳‘׳¡׳“׳¨ ׳™׳•׳¨׳“
    });// ׳”׳—׳–׳¨׳× ׳¨׳©׳™׳׳× ׳”׳”׳–׳׳ ׳•׳×
  } // ׳¡׳™׳•׳ ׳”׳₪׳•׳ ׳§׳¦׳™׳”

  async findOne(id: number) { // ׳©׳׳™׳₪׳× ׳”׳–׳׳ ׳” ׳׳₪׳™ ׳׳–׳”׳”
    return this.orderRepository.findOne({ // ׳—׳™׳₪׳•׳© ׳”׳”׳–׳׳ ׳” ׳‘׳׳¡׳“ ׳”׳ ׳×׳•׳ ׳™׳
      where: { id }, // ׳¡׳™׳ ׳•׳ ׳׳₪׳™ ׳׳–׳”׳” ׳”׳”׳–׳׳ ׳”
      relations: ['items', 'items.product', 'user'], // ׳˜׳¢׳™׳ ׳× ׳”׳§׳©׳¨׳™׳ ׳©׳ ׳₪׳¨׳™׳˜׳™ ׳”׳”׳–׳׳ ׳” ׳•׳”׳׳•׳¦׳¨׳™׳
    
    });   // ׳”׳—׳–׳¨׳× ׳₪׳¨׳˜׳™ ׳”׳”׳–׳׳ ׳”
    } // ׳¡׳™׳•׳ ׳”׳₪׳•׳ ׳§׳¦׳™׳”

  async remove(id: number, userId: number) { // ׳׳—׳™׳§׳× ׳”׳–׳׳ ׳” ׳׳₪׳™ ׳׳–׳”׳”
    const order = await this.orderRepository.findOne({ where: { id, user: { id: userId } } }); // ׳—׳™׳₪׳•׳© ׳”׳”׳–׳׳ ׳” ׳‘׳׳¡׳“ ׳”׳ ׳×׳•׳ ׳™׳
    if (!order) { // ׳‘׳“׳™׳§׳× ׳§׳™׳•׳ ׳”׳”׳–׳׳ ׳”
      throw new NotFoundException('Order not found'); // ׳–׳¨׳™׳§׳× ׳©׳’׳™׳׳” ׳׳ ׳”׳”׳–׳׳ ׳” ׳׳ ׳ ׳׳¦׳׳”
    } // ׳׳—׳™׳§׳× ׳”׳”׳–׳׳ ׳”
    return this.orderRepository.remove(order); // ׳׳—׳™׳§׳× ׳”׳”׳–׳׳ ׳”
  } // ׳¡׳™׳•׳ ׳”׳₪׳•׳ ׳§׳¦׳™׳”
} // ׳¡׳™׳•׳ ׳”׳׳—׳׳§׳”


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order-item\dto\create-order-item.dto.ts
================================
export class CreateOrderItemDto {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order-item\dto\update-order-item.dto.ts
================================
import { PartialType } from '@nestjs/mapped-types';
import { CreateOrderItemDto } from './create-order-item.dto';

export class UpdateOrderItemDto extends PartialType(CreateOrderItemDto) {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order-item\entities\order-item.entity.ts
================================
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne } from 'typeorm';
import { Order } from '../../order/entities/order.entity';
import { Product } from '../../product/entities/product.entity';

@Entity('order_items')
export class OrderItem {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  quantity: number;

  @Column('decimal', { precision: 10, scale: 2 })
  price: number;

  @ManyToOne(() => Order, (order) => order.items, { onDelete: 'CASCADE' })
  order: Order;

  @ManyToOne(() => Product, (product) => product.order_items)
  product: Product;
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order-item\order-item.controller.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { OrderItemController } from './order-item.controller';
import { OrderItemService } from './order-item.service';

describe('OrderItemController', () => {
  let controller: OrderItemController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [OrderItemController],
      providers: [OrderItemService],
    }).compile();

    controller = module.get<OrderItemController>(OrderItemController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order-item\order-item.controller.ts
================================
import { Controller, Get, Post, Body, Patch, Param, Delete } from '@nestjs/common';
import { OrderItemService } from './order-item.service';
import { CreateOrderItemDto } from './dto/create-order-item.dto';
import { UpdateOrderItemDto } from './dto/update-order-item.dto';

@Controller('order-item')
export class OrderItemController {
  constructor(private readonly orderItemService: OrderItemService) {}

  @Post()
  create(@Body() createOrderItemDto: CreateOrderItemDto) {
    return this.orderItemService.create(createOrderItemDto);
  }

  @Get()
  findAll() {
    return this.orderItemService.findAll();
  }

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.orderItemService.findOne(+id);
  }

  @Patch(':id')
  update(@Param('id') id: string, @Body() updateOrderItemDto: UpdateOrderItemDto) {
    return this.orderItemService.update(+id, updateOrderItemDto);
  }

  @Delete(':id')
  remove(@Param('id') id: string) {
    return this.orderItemService.remove(+id);
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order-item\order-item.module.ts
================================
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { OrderItemService } from './order-item.service';
import { OrderItemController } from './order-item.controller';
import { OrderItem } from './entities/order-item.entity'; // <--- ׳”׳×׳™׳§׳•׳: OrderItem ׳‘׳׳§׳•׳ Order_item

@Module({
  imports: [TypeOrmModule.forFeature([OrderItem])],
  controllers: [OrderItemController],
  providers: [OrderItemService],
})
export class OrderItemModule {}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order-item\order-item.service.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { OrderItemService } from './order-item.service';

describe('OrderItemService', () => {
  let service: OrderItemService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [OrderItemService],
    }).compile();

    service = module.get<OrderItemService>(OrderItemService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\order-item\order-item.service.ts
================================
import { Injectable } from '@nestjs/common';
import { CreateOrderItemDto } from './dto/create-order-item.dto';
import { UpdateOrderItemDto } from './dto/update-order-item.dto';

@Injectable()
export class OrderItemService {
  create(createOrderItemDto: CreateOrderItemDto) {
    return 'This action adds a new orderItem';
  }

  findAll() {
    return `This action returns all orderItem`;
  }

  findOne(id: number) {
    return `This action returns a #${id} orderItem`;
  }

  update(id: number, updateOrderItemDto: UpdateOrderItemDto) {
    return `This action updates a #${id} orderItem`;
  }

  remove(id: number) {
    return `This action removes a #${id} orderItem`;
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\product\dto\create-product.dto.ts
================================
import { IsString, IsNumber, IsOptional, Min } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

export class CreateProductDto {
  @ApiProperty({ example: 'iPhone 15', description: '׳©׳ ׳”׳׳•׳¦׳¨' })
  @IsString()
  name: string;

  @ApiProperty({ example: '׳”׳˜׳׳₪׳•׳ ׳”׳—׳“׳© ׳©׳ ׳׳₪׳', required: false })
  @IsString()
  @IsOptional()
  description?: string;

  @ApiProperty({ example: 3999.90 })
  @IsNumber()
  @Min(0)
  price: number;

  @ApiProperty({ example: 'https://example.com/iphone.jpg', required: false })
  @IsOptional()
  @IsString()
  imageUrl?: string;

  @ApiProperty({ example: 10, description: '׳›׳׳•׳× ׳‘׳׳׳׳™' })
  @IsNumber()
  @Min(0)
  stock: number;
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\product\dto\update-product.dto.ts
================================
import { PartialType } from '@nestjs/swagger';
import { CreateProductDto } from './create-product.dto';

export class UpdateProductDto extends PartialType(CreateProductDto) {}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\product\entities\product.entity.ts
================================
import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, UpdateDateColumn, OneToMany } from 'typeorm';
import { OrderItem } from '../../order-item/entities/order-item.entity';

@Entity('products')
export class Product {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  name: string;

  @Column({ type: 'text', nullable: true })
  description: string;

  @Column('decimal', { precision: 10, scale: 2 }) // ׳“׳™׳•׳§ ׳׳׳—׳™׳¨׳™׳ (׳׳׳©׳ 99.90)
  price: number;

  @Column({ nullable: true })
  imageUrl: string;

  @Column({ default: 0 })
  stock: number; // ׳׳׳׳™

  @OneToMany(() => OrderItem, (orderItem) => orderItem.product)
  order_items: OrderItem[];

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\product\product.controller.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { ProductController } from './product.controller';
import { ProductService } from './product.service';

describe('ProductController', () => {
  let controller: ProductController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [ProductController],
      providers: [ProductService],
    }).compile();

    controller = module.get<ProductController>(ProductController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\product\product.controller.ts
================================
import { Controller, Get, Post, Body, Patch, Param, Delete, UseGuards } from '@nestjs/common';
import { ProductService } from './product.service';
import { CreateProductDto } from './dto/create-product.dto';
import { UpdateProductDto } from './dto/update-product.dto';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';
import { ApiTags, ApiOperation, ApiBearerAuth } from '@nestjs/swagger';

@ApiTags('Products')
@Controller('product')
export class ProductController {
  constructor(private readonly productService: ProductService) {}

  @Post()
  @UseGuards(JwtAuthGuard) // ׳¨׳§ ׳׳©׳×׳׳© ׳׳—׳•׳‘׳¨ ׳™׳›׳•׳ ׳׳™׳¦׳•׳¨ ׳׳•׳¦׳¨
  @ApiBearerAuth()
  @ApiOperation({ summary: '׳™׳¦׳™׳¨׳× ׳׳•׳¦׳¨ ׳—׳“׳© (׳“׳•׳¨׳© ׳”׳×׳—׳‘׳¨׳•׳×)' })
  create(@Body() createProductDto: CreateProductDto) {
    return this.productService.create(createProductDto);
  }

  @Get()
  @ApiOperation({ summary: '׳§׳‘׳׳× ׳›׳ ׳”׳׳•׳¦׳¨׳™׳ (׳₪׳×׳•׳— ׳׳›׳•׳׳)' })
  findAll() {
    return this.productService.findAll();
  }

  @Get(':id')
  @ApiOperation({ summary: '׳§׳‘׳׳× ׳׳•׳¦׳¨ ׳׳₪׳™ ׳׳–׳”׳”' })
  findOne(@Param('id') id: string) {
    return this.productService.findOne(+id);
  }

  @Patch(':id')
  @UseGuards(JwtAuthGuard)
  @ApiBearerAuth()
  update(@Param('id') id: string, @Body() updateProductDto: UpdateProductDto) {
    return this.productService.update(+id, updateProductDto);
  }

  @Delete(':id')
  @UseGuards(JwtAuthGuard)
  @ApiBearerAuth()
  remove(@Param('id') id: string) {
    return this.productService.remove(+id);
  }
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\product\product.module.ts
================================
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { ProductService } from './product.service';
import { ProductController } from './product.controller';
import { Product } from './entities/product.entity';

@Module({
  imports: [TypeOrmModule.forFeature([Product])], // <--- ׳—׳©׳•׳‘ ׳׳׳•׳“! ׳׳—׳‘׳¨ ׳׳× ׳”-Entity
  controllers: [ProductController],
  providers: [ProductService],
})
export class ProductModule {}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\product\product.service.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { ProductService } from './product.service';

describe('ProductService', () => {
  let service: ProductService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [ProductService],
    }).compile();

    service = module.get<ProductService>(ProductService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\product\product.service.ts
================================
import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { CreateProductDto } from './dto/create-product.dto';
import { UpdateProductDto } from './dto/update-product.dto';
import { Product } from './entities/product.entity';

@Injectable()
export class ProductService {
  constructor(
    @InjectRepository(Product)
    private productRepository: Repository<Product>,
  ) {}

  create(createProductDto: CreateProductDto) {
    const product = this.productRepository.create(createProductDto);
    return this.productRepository.save(product);
  }

  findAll() {
    return this.productRepository.find();
  }

  async findOne(id: number) {
    const product = await this.productRepository.findOne({ where: { id } });
    if (!product) {
      throw new NotFoundException(`Product with ID ${id} not found`);
    }
    return product;
  }

  async update(id: number, updateProductDto: UpdateProductDto) {
    const product = await this.findOne(id); // ׳׳•׳•׳“׳ ׳©׳§׳™׳™׳
    Object.assign(product, updateProductDto); // ׳׳¢׳“׳›׳ ׳©׳“׳•׳×
    return this.productRepository.save(product);
  }

  async remove(id: number) {
    const product = await this.findOne(id);
    return this.productRepository.remove(product);
  }
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\users\dto\create-user.dto.ts
================================
import { IsString, IsEmail, MinLength } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

export class CreateUserDto {
  @ApiProperty({ example: 'john_doe' })
  @IsString()
  username: string;

  @ApiProperty({ example: 'john@example.com' })
  @IsEmail()
  email: string;

  @ApiProperty({ example: '123456', description: '׳¡׳™׳¡׳׳” ׳‘׳׳•׳¨׳ 6 ׳×׳•׳•׳™׳ ׳׳₪׳—׳•׳×' })
  @IsString()
  @MinLength(6) // ׳•׳׳™׳“׳¦׳™׳” ׳׳¡׳™׳¡׳׳”
  password: string; // ׳–׳” ׳”׳©׳“׳” ׳©׳”׳™׳” ׳—׳¡׳¨ ׳׳!
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\users\dto\update-user.dto.ts
================================
import { PartialType } from '@nestjs/mapped-types';
import { CreateUserDto } from './create-user.dto';

export class UpdateUserDto extends PartialType(CreateUserDto) {}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\users\entities\user.entity.ts
================================
import { Cart } from 'src/cart/entities/cart.entity';
import { Order } from 'src/order/entities/order.entity';
import { Entity, OneToOne, CreateDateColumn, PrimaryGeneratedColumn, Column, OneToMany } from 'typeorm';
import { Exclude } from 'class-transformer'; // <--- 1. ׳”׳•׳¡׳₪׳× ׳”׳™׳™׳‘׳•׳

@Entity('users')
export class User {
  @PrimaryGeneratedColumn() // ׳™׳•׳¦׳¨ ׳¢׳׳•׳“׳× ID ׳׳•׳˜׳•׳׳˜׳™׳×
  id: number;

  @Column({ unique: true })
  username: string;

  @Column()
  email: string;

  @Column()
  @Exclude() // <--- 2. ׳”׳•׳¡׳₪׳× ׳”׳“׳§׳•׳¨׳˜׳•׳¨ ׳©׳׳¡׳×׳™׳¨ ׳׳× ׳”׳¡׳™׳¡׳׳”
  password: string;

  @CreateDateColumn()
  createdAt: Date;

  @OneToMany(() => Order, (order) => order.user)
  orders: Order[];

  @OneToOne(() => Cart, (cart) => cart.user)
  carts: Cart;
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\users\users.controller.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { UsersController } from './users.controller';
import { UsersService } from './users.service';

describe('UsersController', () => {
  let controller: UsersController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [UsersController],
      providers: [UsersService],
    }).compile();

    controller = module.get<UsersController>(UsersController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\users\users.controller.ts
================================
// 


import { 
  Controller, 
  Get, 
  Post, 
  Body, 
  Patch, 
  Param, 
  Delete, 
  UseGuards, 
  ParseIntPipe 
} from '@nestjs/common';
import { UsersService } from './users.service';
import { CreateUserDto } from './dto/create-user.dto';
import { UpdateUserDto } from './dto/update-user.dto';
import { ApiTags, ApiOperation, ApiBearerAuth } from '@nestjs/swagger';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';

@ApiTags('Users Management') // ׳›׳•׳×׳¨׳× ׳™׳₪׳” ׳‘׳¡׳•׳•׳׳’׳¨
@Controller('users')
@UseGuards(JwtAuthGuard) // ׳׳’׳ ׳¢׳ ׳›׳ ׳”׳₪׳¢׳•׳׳•׳× ׳‘׳§׳•׳ ׳˜׳¨׳•׳׳¨ ׳”׳–׳”! ׳¨׳§ ׳׳™ ׳©׳׳—׳•׳‘׳¨ ׳™׳›׳•׳ ׳׳’׳©׳×
@ApiBearerAuth() // ׳׳•׳¡׳™׳£ ׳׳× ׳”׳׳ ׳¢׳•׳ ׳‘׳¡׳•׳•׳׳’׳¨
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Post()
  @ApiOperation({ summary: '׳™׳¦׳™׳¨׳× ׳׳©׳×׳׳© ׳—׳“׳© (Admin)' })
  create(@Body() createUserDto: CreateUserDto) {
    return this.usersService.create(createUserDto);
  }

  @Get()
  @ApiOperation({ summary: '׳§׳‘׳׳× ׳¨׳©׳™׳׳× ׳›׳ ׳”׳׳©׳×׳׳©׳™׳' })
  findAll() {
    return this.usersService.findAll();
  }

  @Get(':id')
  @ApiOperation({ summary: '׳§׳‘׳׳× ׳׳©׳×׳׳© ׳¡׳₪׳¦׳™ ׳׳₪׳™ ID' })
  // ParseIntPipe - ׳”׳•׳₪׳ ׳׳•׳˜׳•׳׳˜׳™׳× ׳׳× ׳”׳˜׳§׳¡׳˜ ׳׳׳¡׳₪׳¨ ׳•׳׳•׳ ׳¢ ׳׳× ׳”׳©׳’׳™׳׳” ׳©׳”׳™׳™׳×׳” ׳׳!
  findOne(@Param('id', ParseIntPipe) id: number) {
    return this.usersService.findOne(id);
  }

  @Patch(':id')
  @ApiOperation({ summary: '׳¢׳“׳›׳•׳ ׳₪׳¨׳˜׳™ ׳׳©׳×׳׳©' })
  update(
    @Param('id', ParseIntPipe) id: number, 
    @Body() updateUserDto: UpdateUserDto
  ) {
    return this.usersService.update(id, updateUserDto);
  }

  @Delete(':id')
  @ApiOperation({ summary: '׳׳—׳™׳§׳× ׳׳©׳×׳׳©' })
  remove(@Param('id', ParseIntPipe) id: number) {
    return this.usersService.remove(id);
  }
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\users\users.module.ts
================================
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { UsersService } from './users.service';
import { UsersController } from './users.controller';
import { User } from './entities/user.entity';

@Module({
  imports: [TypeOrmModule.forFeature([User])],
  controllers: [UsersController],
  providers: [UsersService],
  exports: [UsersService] // <--- ׳”׳•׳¡׳£ ׳׳× ׳”׳©׳•׳¨׳” ׳”׳–׳•! ׳‘׳׳¢׳“׳™׳” ׳”׳©׳¨׳× ׳™׳§׳¨׳•׳¡
})
export class UsersModule {}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\users\users.service.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { UsersService } from './users.service';

describe('UsersService', () => {
  let service: UsersService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [UsersService],
    }).compile();

    service = module.get<UsersService>(UsersService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\users\users.service.ts
================================
// 


import { Injectable, NotFoundException, ConflictException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { User } from './entities/user.entity';
import { CreateUserDto } from './dto/create-user.dto';
import { UpdateUserDto } from './dto/update-user.dto';
import * as bcrypt from 'bcrypt';

@Injectable()
export class UsersService {
  constructor(
    @InjectRepository(User)
    private usersRepository: Repository<User>,
  ) {}

  // --- 1. ׳₪׳•׳ ׳§׳¦׳™׳•׳× ׳¢׳–׳¨ ׳׳׳™׳׳•׳× (Auth) ---

  async findByUsername(username: string): Promise<User | null> {
    return this.usersRepository.findOne({ where: { username } });
  }

  // --- 2. ׳™׳¦׳™׳¨׳× ׳׳©׳×׳׳© (Create) ---
  
 async create(createUserDto: CreateUserDto): Promise<User> {
    const { password, username } = createUserDto;

    const existingUser = await this.findByUsername(username);
    if (existingUser) {
      throw new ConflictException('׳©׳ ׳”׳׳©׳×׳׳© ׳›׳‘׳¨ ׳×׳₪׳•׳¡');
    }

    const hashedPassword = await bcrypt.hash(password, 10);

    const newUser = this.usersRepository.create({
      ...createUserDto,
      password: hashedPassword,
    });

    const savedUser = await this.usersRepository.save(newUser);
    
    // --- ׳”׳×׳™׳§׳•׳ ׳›׳׳ ---
    // ׳׳ ׳—׳ ׳• ׳׳₪׳¨׳§׳™׳ ׳׳× savedUser: ׳׳•׳§׳—׳™׳ ׳׳× ׳”׳¡׳™׳¡׳׳” ׳׳¦׳“ ׳׳—׳“, ׳•׳׳× ׳›׳ ׳”׳©׳׳¨ ׳-result
    // ׳׳‘׳! ׳‘׳’׳׳ ׳©׳¡׳•׳’ ׳”׳”׳—׳–׳¨׳” ׳”׳•׳ Promise<User>, ׳”׳©׳™׳˜׳” ׳”׳¨׳׳©׳•׳ ׳” (any) ׳§׳׳” ׳™׳•׳×׳¨ ׳׳׳×׳—׳™׳׳™׳.
    // ׳׳ ׳׳×׳” ׳¨׳•׳¦׳” ׳׳”׳©׳×׳׳© ׳‘׳–׳”, ׳×׳¦׳˜׳¨׳ ׳׳©׳ ׳•׳× ׳׳× ׳”-delete ׳›׳׳• ׳‘׳₪׳×׳¨׳•׳ 1, ׳׳• ׳׳”׳—׳–׳™׳¨ ׳˜׳™׳₪׳•׳¡ ׳›׳׳׳™.
    
    delete (savedUser as any).password; // ׳”׳›׳™ ׳₪׳©׳•׳˜ ׳›׳¨׳’׳¢
    return savedUser;
  }

  // --- 3. ׳§׳¨׳™׳׳× ׳ ׳×׳•׳ ׳™׳ (Read) ---

  async findAll(): Promise<User[]> {
    return this.usersRepository.find();
  }

  async findOne(id: number): Promise<User> {
    const user = await this.usersRepository.findOne({ where: { id } });
    if (!user) {
      throw new NotFoundException(`׳׳©׳×׳׳© ׳¢׳ ׳׳–׳”׳” ${id} ׳׳ ׳ ׳׳¦׳`);
    }
    return user;
  }

  // --- 4. ׳¢׳“׳›׳•׳ (Update) ---

  async update(id: number, updateUserDto: UpdateUserDto): Promise<User> {
    // ׳‘׳“׳™׳§׳” ׳©׳”׳׳©׳×׳׳© ׳§׳™׳™׳ ׳׳₪׳ ׳™ ׳”׳¢׳“׳›׳•׳
    await this.findOne(id);

    // ׳׳ ׳׳¢׳“׳›׳ ׳™׳ ׳¡׳™׳¡׳׳” - ׳¦׳¨׳™׳ ׳׳”׳¦׳₪׳™׳ ׳׳•׳×׳” ׳׳—׳“׳©
    if (updateUserDto.password) {
      updateUserDto.password = await bcrypt.hash(updateUserDto.password, 10);
    }

    // ׳‘׳™׳¦׳•׳¢ ׳”׳¢׳“׳›׳•׳
    await this.usersRepository.update(id, updateUserDto);
    
    // ׳”׳—׳–׳¨׳× ׳”׳׳©׳×׳׳© ׳”׳׳¢׳•׳“׳›׳
    return this.findOne(id);
  }

  // --- 5. ׳׳—׳™׳§׳” (Delete) ---

  async remove(id: number): Promise<void> {
    const result = await this.usersRepository.delete(id);
    if (result.affected === 0) {
      throw new NotFoundException(`׳׳©׳×׳׳© ׳¢׳ ׳׳–׳”׳” ${id} ׳׳ ׳ ׳׳¦׳`);
    }
  }
}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\app.controller.spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { AppController } from './app.controller';
import { AppService } from './app.service';

describe('AppController', () => {
  let appController: AppController;

  beforeEach(async () => {
    const app: TestingModule = await Test.createTestingModule({
      controllers: [AppController],
      providers: [AppService],
    }).compile();

    appController = app.get<AppController>(AppController);
  });

  describe('root', () => {
    it('should return "Hello World!"', () => {
      expect(appController.getHello()).toBe('Hello World!');
    });
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\app.controller.ts
================================
import { Controller, Get } from '@nestjs/common';
import { AppService } from './app.service';

@Controller()
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get()
  getHello(): string {
    return this.appService.getHello();
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\app.module.ts
================================
import { Module } from '@nestjs/common';
import { ConfigModule, ConfigService} from '@nestjs/config'; // ׳—׳•׳‘׳” ׳¢׳‘׳•׳¨ ׳”-.env
import { AuthModule } from './auth/auth.module'; // ׳”׳׳•׳“׳•׳ ׳©׳‘׳ ׳™׳ ׳•
import { UsersModule } from './users/users.module';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { CartModule } from './cart/cart.module';
import { OrderModule } from './order/order.module';
import { CartItemModule } from './cart-item/cart-item.module';
import { OrderItemModule } from './order-item/order-item.module';
import { ProductModule } from './product/product.module';
import { TypeOrmModule } from '@nestjs/typeorm';
// ... ׳©׳׳¨ ׳”׳™׳™׳‘׳•׳׳™׳ ׳©׳׳ (Cart, Order ׳•׳›׳•')

@Module({
  imports: [
    // ׳”׳’׳“׳¨׳× ConfigModule ׳›׳’׳׳•׳‘׳׳™ ׳›׳“׳™ ׳©׳›׳ ׳”׳׳₪׳׳™׳§׳¦׳™׳” ׳×׳›׳™׳¨ ׳׳× ׳”-JWT_SECRET
    ConfigModule.forRoot({
      isGlobal: true, 
    }),
    TypeOrmModule.forRootAsync({
      imports: [ConfigModule],
      inject: [ConfigService],
      useFactory: (configService: ConfigService) => ({
        type: 'postgres',
        host: configService.get('DATABASE_HOST') || 'localhost',
        port: configService.get('DATABASE_PORT') || 5432,
        username: configService.get('DATABASE_USER') || 'postgres',
        password: configService.get('DATABASE_PASSWORD') || 'postgres',
        database: configService.get('DATABASE_NAME') || 'shopping_app',
        // ׳׳•׳ ׳¢ ׳׳—׳™׳§׳× ׳ ׳×׳•׳ ׳™׳ ׳‘׳¡׳‘׳™׳‘׳× ׳™׳™׳¦׳•׳¨ (Production)
        synchronize: configService.get('NODE_ENV') !== 'production',
        logging: false,
        autoLoadEntities: true
      }),
    }), // ׳•׳•׳“׳ ׳©׳™׳© ׳׳ ׳§׳•׳‘׳¥ ormconfig.json ׳׳• ׳”׳’׳“׳¨׳•׳× ׳׳×׳׳™׳׳•׳× ׳›׳׳
    AuthModule, // ׳”׳•׳¡׳₪׳× ׳׳•׳“׳•׳ ׳”׳׳™׳׳•׳×
    UsersModule,
    CartModule,
    OrderModule,
    CartItemModule,
    OrderItemModule,
    ProductModule,
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}


================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\app.service.ts
================================
import { Injectable } from '@nestjs/common';

@Injectable()
export class AppService {
  getHello(): string {
    return 'Hello World!';
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\src\main.ts
================================
import { NestFactory, Reflector } from '@nestjs/core';
import { AppModule } from './app.module';
import { SwaggerModule, DocumentBuilder } from '@nestjs/swagger';
import { ValidationPipe, ClassSerializerInterceptor } from '@nestjs/common';
import cookieParser from 'cookie-parser';
 // <--- 1. ׳™׳™׳‘׳•׳ ׳”׳¡׳₪׳¨׳™׳™׳”

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  // ׳”׳’׳“׳¨׳× CORS - ׳—׳•׳‘׳” ׳›׳“׳™ ׳׳¢׳‘׳•׳“ ׳¢׳ React ׳•-Cookies
  app.enableCors({
    origin: 'http://localhost:5173', // ׳”׳›׳×׳•׳‘׳× ׳©׳ ׳”-Frontend ׳©׳׳ (׳׳׳©׳ Vite)
    credentials: true, // ׳—׳•׳‘׳”! ׳׳׳₪׳©׳¨ ׳©׳׳™׳—׳× Cookies
  });

  app.use(cookieParser()); // <--- 2. ׳”׳₪׳¢׳׳× ׳”-Middleware

  app.useGlobalPipes(new ValidationPipe({
    whitelist: true,
    transform: true,
  }));

  app.useGlobalInterceptors(new ClassSerializerInterceptor(app.get(Reflector)));

  const config = new DocumentBuilder()
    .setTitle('Shopping App')
    .setDescription('API documentation for my shopping app')
    .setVersion('1.0')
    .addBearerAuth()
    .build();
    
  const document = SwaggerModule.createDocument(app, config);
  SwaggerModule.setup('api', app, document);

  await app.listen(process.env.PORT ?? 3000);
  console.log(`Application is running on: ${await app.getUrl()}/api`);
}
bootstrap();



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\test\app.e2e-spec.ts
================================
import { Test, TestingModule } from '@nestjs/testing';
import { INestApplication } from '@nestjs/common';
import request from 'supertest';
import { App } from 'supertest/types';
import { AppModule } from './../src/app.module';

describe('AppController (e2e)', () => {
  let app: INestApplication<App>;

  beforeEach(async () => {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    await app.init();
  });

  it('/ (GET)', () => {
    return request(app.getHttpServer())
      .get('/')
      .expect(200)
      .expect('Hello World!');
  });
});



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\test\jest-e2e.json
================================
{
  "moduleFileExtensions": ["js", "json", "ts"],
  "rootDir": ".",
  "testEnvironment": "node",
  "testRegex": ".e2e-spec.ts$",
  "transform": {
    "^.+\\.(t|j)s$": "ts-jest"
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\nest-cli.json
================================
{
  "$schema": "https://json.schemastore.org/nest-cli",
  "collection": "@nestjs/schematics",
  "sourceRoot": "src",
  "compilerOptions": {
    "deleteOutDir": true
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\package.json
================================
{
  "name": "server-app",
  "version": "0.0.1",
  "description": "",
  "author": "",
  "private": true,
  "license": "UNLICENSED",
  "scripts": {
    "build": "nest build",
    "format": "prettier --write \"src/**/*.ts\" \"test/**/*.ts\"",
    "start": "nest start",
    "start:dev": "nest start --watch",
    "start:debug": "nest start --debug --watch",
    "start:prod": "node dist/main",
    "lint": "eslint \"{src,apps,libs,test}/**/*.ts\" --fix",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:cov": "jest --coverage",
    "test:debug": "node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand",
    "test:e2e": "jest --config ./test/jest-e2e.json"
  },
  "dependencies": {
    "@nestjs/common": "^11.0.1",
    "@nestjs/config": "^4.0.2",
    "@nestjs/core": "^11.0.1",
    "@nestjs/jwt": "^11.0.2",
    "@nestjs/mapped-types": "*",
    "@nestjs/passport": "^11.0.5",
    "@nestjs/platform-express": "^11.0.1",
    "@nestjs/swagger": "^11.2.3",
    "@nestjs/typeorm": "^11.0.0",
    "@types/passport-google-oauth20": "^2.0.17",
    "bcrypt": "^6.0.0",
    "class-transformer": "^0.5.1",
    "class-validator": "^0.14.3",
    "cookie-parser": "^1.4.7",
    "mysql2": "^3.16.0",
    "passport": "^0.7.0",
    "passport-google-oauth20": "^2.0.0",
    "passport-jwt": "^4.0.1",
    "passport-local": "^1.0.0",
    "pg": "^8.16.3",
    "reflect-metadata": "^0.2.2",
    "rxjs": "^7.8.1",
    "swagger-ui-express": "^5.0.1",
    "typeorm": "^0.3.28"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3.2.0",
    "@eslint/js": "^9.18.0",
    "@nestjs/cli": "^11.0.0",
    "@nestjs/schematics": "^11.0.0",
    "@nestjs/testing": "^11.0.1",
    "@types/bcrypt": "^6.0.0",
    "@types/cookie-parser": "^1.4.10",
    "@types/express": "^5.0.6",
    "@types/jest": "^30.0.0",
    "@types/jsonwebtoken": "^9.0.10",
    "@types/node": "^22.10.7",
    "@types/passport-jwt": "^4.0.1",
    "@types/passport-local": "^1.0.38",
    "@types/supertest": "^6.0.2",
    "eslint": "^9.18.0",
    "eslint-config-prettier": "^10.0.1",
    "eslint-plugin-prettier": "^5.2.2",
    "globals": "^16.0.0",
    "jest": "^30.0.0",
    "prettier": "^3.4.2",
    "source-map-support": "^0.5.21",
    "supertest": "^7.0.0",
    "ts-jest": "^29.2.5",
    "ts-loader": "^9.5.2",
    "ts-node": "^10.9.2",
    "tsconfig-paths": "^4.2.0",
    "typescript": "^5.7.3",
    "typescript-eslint": "^8.20.0"
  },
  "jest": {
    "moduleFileExtensions": [
      "js",
      "json",
      "ts"
    ],
    "rootDir": "src",
    "testRegex": ".*\\.spec\\.ts$",
    "transform": {
      "^.+\\.(t|j)s$": "ts-jest"
    },
    "collectCoverageFrom": [
      "**/*.(t|j)s"
    ],
    "coverageDirectory": "../coverage",
    "testEnvironment": "node"
  }
}



================================
FILE: C:\Users\Israel\Desktop\‏‏תיקיה חדשה\לימודים\לימודים ערן\Shopping_App\server-app\tsconfig.json
================================
{
  "compilerOptions": {
    "module": "nodenext",
    "moduleResolution": "nodenext",
    "resolvePackageJsonExports": true,
    "esModuleInterop": true,
    "isolatedModules": true,
    "declaration": true,
    "removeComments": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "allowSyntheticDefaultImports": true,
    "target": "ES2023",
    "sourceMap": true,
    "outDir": "./dist",
    "baseUrl": "./",
    "incremental": true,
    "skipLibCheck": true,
    "strictNullChecks": true,
    "forceConsistentCasingInFileNames": true,
    "noImplicitAny": false,
    "strictBindCallApply": false,
    "noFallthroughCasesInSwitch": false
  }
}



